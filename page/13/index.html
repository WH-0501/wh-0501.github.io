<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Pisces","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"copycode":{"enable":false,"style":null},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta property="og:type" content="website">
<meta property="og:title" content="Daemo">
<meta property="og:url" content="http://example.com/page/13/index.html">
<meta property="og:site_name" content="Daemo">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Damon">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/page/13/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"page/13/index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Daemo</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">Daemo</h1>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">内诚于心，外信于人</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Damon</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">128</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">19</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Damon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daemo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Daemo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">moveit-问题记录</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-01 21:17:54" itemprop="dateCreated datePublished" datetime="2024-09-01T21:17:54+08:00">2024-09-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-22 14:42:30" itemprop="dateModified" datetime="2024-09-22T14:42:30+08:00">2024-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/" itemprop="url" rel="index"><span itemprop="name">机械臂</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/" itemprop="url" rel="index"><span itemprop="name">MoveIt</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>9.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>17 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="semantic-错误"><a href="#semantic-错误" class="headerlink" title="semantic 错误"></a><strong>semantic 错误</strong></h1><p>① Semantic description is not specified ..</p>
<p>未指定 SRDF 文件(通常在 planning_context.launch 中)</p>
<p>② Semantic description is not specified for the same robot as the URDF</p>
<p>修改了机械臂模型，但未重新生成 SRDF。例如：将机械臂安装在车上，但仍使用机械臂的 SRDF。</p>
<h1 id="move-group-加载慢"><a href="#move-group-加载慢" class="headerlink" title="move_group 加载慢"></a><strong>move_group 加载慢</strong></h1><p>move_group 启动很慢，并提示：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">It is likely there are too many vertices in collision geometry  </span><br></pre></td></tr></table></figure>

<p>​      </p>
<p>原因：导出的模型(STL&#x2F;dae)太详细，进行碰撞检测时变慢，可减少面或顶点数。注意，只需要修改  中的  即可，无需修改  中的参数。</p>
<h1 id="panda-moveit-config-demo"><a href="#panda-moveit-config-demo" class="headerlink" title="panda_moveit_config demo"></a><strong>panda_moveit_config demo</strong></h1><p>运行 demo 程序</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">roslaunch panda_moveit_config demo.launch rviz_tutorial:=<span class="literal">true</span></span>  </span><br></pre></td></tr></table></figure>

<p>​     </p>
<p>无法加载插件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Exception while loading planning adapter plugin &#x27;default_planner_request_adapters/ResolveConstraintFrames&#x27;: According to the loaded plugin descriptions the class default_planner_request_adapters/ResolveConstraintFrames with base class type planning_request_adapter::PlanningRequestAdapter does not exist. Declared types are  chomp/OptimizerAdapter default_planner_request_adapters/AddIterativeSplineParameterization default_planner_request_adapters/AddTimeOptimalParameterization default_planner_request_adapters/AddTimeParameterization default_planner_request_adapters/Empty default_planner_request_adapters/FixStartStateBounds default_planner_request_adapters/FixStartStateCollision default_planner_request_adapters/FixStartStatePathConstraints default_planner_request_adapters/FixWorkspaceBounds              </span><br></pre></td></tr></table></figure>



<p>屏蔽 <code>panda_moveit_config/launch/ompl_planning_pipeline.launch.xml</code> 及 <code>chomp_planning_pipeline.launch.xml</code> 文件中的 controller 配置</p>
<h1 id="moveit-tutorials-无法加载-motion-planning"><a href="#moveit-tutorials-无法加载-motion-planning" class="headerlink" title="moveit_tutorials 无法加载 motion planning"></a><strong>moveit_tutorials 无法加载 motion planning</strong></h1><p>运行 moveit_tutorials demo 时，rviz 卡死在添加 motion planning 插件上</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">roslaunch panda_moveit_config demo.launch rviz_tutorial:=<span class="literal">true</span></span></span><br></pre></td></tr></table></figure>

<p>​              </p>
<h1 id="execution-type-导致异常"><a href="#execution-type-导致异常" class="headerlink" title="execution_type 导致异常"></a><strong>execution_type 导致异常</strong></h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RLException: unused args [execution_type] for include of [rxxx_moveit_config/launch/xxx_moveit_controller_manager.launch.xml]     </span><br></pre></td></tr></table></figure>

<p>​         </p>
<p>xxx_moveit_controller_manager.launch.xml 中添加 execution_type 定义</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212011075.png" class="" title="image-20240901212011075">



<h1 id="visual-array-警告"><a href="#visual-array-警告" class="headerlink" title="visual_array 警告"></a><strong>visual_array 警告</strong></h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attempted to add visual [link_base] to link [JXB], but it already exists in visual_array under name [link_base] </span><br></pre></td></tr></table></figure>

<p>​             </p>
<p>机械臂挂载到移动底盘时，挂载 joint 重复导致的。</p>
<h1 id="停止轨迹执行"><a href="#停止轨迹执行" class="headerlink" title="停止轨迹执行"></a><strong>停止轨迹执行</strong></h1><p>轨迹执行过程中停止</p>
<h2 id="asyncMove"><a href="#asyncMove" class="headerlink" title="asyncMove"></a><strong>asyncMove</strong></h2><p>轨迹规划及执行。有两种 move 指令：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">asyncMove</span>()  <span class="comment">// 可通过 stop() 停止轨迹 </span></span><br><span class="line"><span class="built_in">move</span>()    </span><br></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="http://docs.ros.org/en/jade/api/moveit_ros_planning_interface/html/classmoveit_1_1planning__interface_1_1MoveGroup.html#a65af5d80f04a9557b627d7d0bcb1e097">asyncMove</a>：规划并执行轨迹。<strong>非阻塞</strong>(不等待轨迹的执行完成)</li>
<li><a target="_blank" rel="noopener" href="http://docs.ros.org/en/jade/api/moveit_ros_planning_interface/html/classmoveit_1_1planning__interface_1_1MoveGroup.html#a4c63625e2e9eb5c342d1fc6732bd8cf7">move</a>：规划并执行轨迹。<strong>阻塞</strong>(等待轨迹的执行完成)，并且需要启动一个 asynchronous spinner</li>
</ul>
<p>对应 python 下为：</p>
<ul>
<li>async_move</li>
<li>move</li>
</ul>
<h2 id="async-execute"><a href="#async-execute" class="headerlink" title="async_execute"></a><strong>async_execute</strong></h2><p>轨迹执行(不包括轨迹规划过程)。有两种 execute 指令：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">async_execute</span>() <span class="comment">// 执行过程中可通过 stop() 停止 </span></span><br><span class="line"><span class="built_in">execute</span>()    </span><br></pre></td></tr></table></figure>



<p>例如：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">moveit::planning_interface::MoveGroupInterface::Plan my_plan;  </span><br><span class="line">moveit::planning_interface::MoveItErrorCode success = group.<span class="built_in">plan</span>(my_plan)  </span><br><span class="line">group.<span class="built_in">asyncexecute</span>(my_plan);  </span><br><span class="line"><span class="built_in">sleep</span>(<span class="number">1</span>);  </span><br><span class="line">group.<span class="built_in">stop</span>();  </span><br><span class="line"><span class="built_in">sleep</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">plan=arm.<span class="built_in">plan</span>()  </span><br><span class="line">arm.<span class="built_in">execute</span>(plan,wait=False)  </span><br><span class="line">rospy.<span class="built_in">loginfo</span>(<span class="string">&quot;move home finished&quot;</span>)  </span><br><span class="line">rospy.<span class="built_in">sleep</span>(<span class="number">0.5</span>)  </span><br><span class="line">arm.<span class="built_in">stop</span>()  </span><br><span class="line">rospy.<span class="built_in">loginfo</span>(<span class="string">&quot;stoped&quot;</span>)  </span><br><span class="line">rospy.<span class="built_in">sleep</span>(<span class="number">0.5</span>)  </span><br><span class="line">moveit_commander.<span class="built_in">roscpp_shutdown</span>()</span><br></pre></td></tr></table></figure>



<p>execute() 接口，通过 actionlib 向 <strong>execute_trajectory</strong> 发送 moveit_msgs::ExecuteTrajectoryGoal 类型 </p>
<h2 id="go"><a href="#go" class="headerlink" title="go"></a><strong>go</strong></h2><p>将 wait 参数设置为 false</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">group.go(wait=<span class="literal">False</span>)   </span><br></pre></td></tr></table></figure>

<p>​           </p>
<p>然后通过订阅 &#x2F;move_group&#x2F;status 获取轨迹执行状态。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># moveit_commander/src</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">go</span>(<span class="params">self, joints=<span class="literal">None</span>, wait=<span class="literal">True</span></span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot; Set the target of the group and then move the group to the specified target &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">type</span>(joints) <span class="keyword">is</span> <span class="built_in">bool</span>:</span><br><span class="line">        wait = joints</span><br><span class="line">        joints = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span>(joints) <span class="keyword">is</span> JointState:</span><br><span class="line">        <span class="variable language_">self</span>.set_joint_value_target(joints)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">type</span>(joints) <span class="keyword">is</span> Pose:</span><br><span class="line">        <span class="variable language_">self</span>.set_pose_target(joints)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> joints <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="variable language_">self</span>.set_joint_value_target(<span class="variable language_">self</span>.get_remembered_joint_values()[joints])</span><br><span class="line">        <span class="keyword">except</span> TypeError:</span><br><span class="line">            <span class="variable language_">self</span>.set_joint_value_target(joints)</span><br><span class="line">    <span class="keyword">if</span> wait:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._g.move()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">self</span>._g.async_move()</span><br></pre></td></tr></table></figure>



<p>go() 函数通过调用 move()&#x2F;async_move()，其中 async_move() 实际是调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">move(<span class="literal">False</span>) <span class="comment"># 即：wait 参数为 False, 非阻塞   </span></span><br></pre></td></tr></table></figure>

<p>​        </p>
<p>move() 接口通过 actionlib 向 move_group 发送 moveit_msgs::MoveGroupGoal  类型 goal。</p>
<p>设置为 unblock 模式后，前一条轨迹未执行完时，接收到新的指令，会自动执行新的指令。</p>
<h1 id="轨迹起点异常"><a href="#轨迹起点异常" class="headerlink" title="轨迹起点异常"></a><strong>轨迹起点异常</strong></h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Invalid Trajectory: start point deviates from current robot state more than 0.01 </span><br></pre></td></tr></table></figure>

<p>​             </p>
<p>可能原因：</p>
<ul>
<li>机械臂抖动大，导致起始位姿改变</li>
<li>move_group 获取的机械臂状态不对</li>
</ul>
<p>原因1解决方法</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置机械臂当前的状态作为运动初始状态</span></span><br><span class="line">group.setStartStateToCurrentState()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或者放大允许误差范围</span></span><br><span class="line">group.setGoalPositionTolernace(<span class="number">0.001</span>)</span><br><span class="line">group.setGoalOrientationTolernace(<span class="number">0.02</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 或修改文件参数(无法通过 rosparam set 设置)</span></span><br><span class="line">/move_group/trajectory_execution/allowed_start_tolerance <span class="number">0.0</span></span><br></pre></td></tr></table></figure>



<p>原因2解决方法</p>
<p>查看是否有节点重复发布机械臂关节状态。关掉 launch 中重复的 joint_state_publisher，例如：</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212441818.png" class="" title="image-20240901212441818">

<p>可以看到有重复发布机械臂关节</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">header:</span> </span><br><span class="line">  <span class="attr">seq:</span> <span class="number">39288</span></span><br><span class="line">  <span class="attr">stamp:</span> </span><br><span class="line">    <span class="attr">secs:</span> <span class="number">1662717522</span></span><br><span class="line">    <span class="attr">nsecs:</span> <span class="number">857585906</span></span><br><span class="line">  <span class="attr">frame_id:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="attr">name:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">front_left_wheel</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">front_right_wheel</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">rear_left_wheel</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">rear_right_wheel</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_shoulder_pan_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_shoulder_lift_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_elbow_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_wrist_1_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_wrist_2_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_wrist_3_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">gripper_finger1_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">gripper_finger2_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">gripper_finger1_inner_knuckle_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">gripper_finger2_inner_knuckle_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">gripper_finger1_finger_tip_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">gripper_finger2_finger_tip_joint</span></span><br><span class="line"><span class="attr">position:</span> [<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line"><span class="attr">velocity:</span> []</span><br><span class="line"><span class="attr">effort:</span> []</span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">header:</span> </span><br><span class="line">  <span class="attr">seq:</span> <span class="number">260742</span></span><br><span class="line">  <span class="attr">stamp:</span> </span><br><span class="line">    <span class="attr">secs:</span> <span class="number">1662717522</span></span><br><span class="line">    <span class="attr">nsecs:</span> <span class="number">862274557</span></span><br><span class="line">  <span class="attr">frame_id:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="attr">name:</span> </span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_elbow_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_shoulder_lift_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_shoulder_pan_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_wrist_1_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_wrist_2_joint</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">ur5_wrist_3_joint</span></span><br><span class="line"><span class="attr">position:</span> [<span class="number">1.7724227905273438</span>, <span class="number">-2.3259976545916956</span>, <span class="number">1.5698211193084717</span>, <span class="number">0.5097464323043823</span>, <span class="number">1.4149070978164673</span>, <span class="number">3.5952674807049334e-05</span>]</span><br><span class="line"><span class="attr">velocity:</span> [<span class="number">-0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line"><span class="attr">effort:</span> [<span class="number">-0.8272280693054199</span>, <span class="number">1.4930458068847656</span>, <span class="number">-0.46405479311943054</span>, <span class="number">-0.24553163349628448</span>, <span class="number">0.13877874612808228</span>, <span class="number">0.03812602907419205</span>]</span><br></pre></td></tr></table></figure>



<h1 id="无法识别任何一组控制器"><a href="#无法识别任何一组控制器" class="headerlink" title="无法识别任何一组控制器"></a><strong>无法识别任何一组控制器</strong></h1><p>Unable to identify any set of controllers that can actuate the specified joints:</p>
<p>参考： <a target="_blank" rel="noopener" href="https://blog.csdn.net/ha010/article/details/109274459">https://blog.csdn.net/ha010/article/details/109274459</a></p>
<h2 id="gazebo-中-controllers"><a href="#gazebo-中-controllers" class="headerlink" title="gazebo 中 controllers"></a><strong>gazebo 中 controllers</strong></h2><p>以 xxxx+Kinova 为例，gazebo launch 中会通过 kinova_control.launch 来配置 controllers：</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212655189.png" class="" title="image-20240901212655189">

<p>可见，kinova_control.launch 在启动 controller_spawner 时，设置了命名空间(kinova_robotName 参数指定)和 controller 名</p>
<p>同时 kinova_control.launch 会加载 $(arg kinova_robotName)_control.yaml 配置文件</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212720316.png" class="" title="image-20240901212720316">



<h2 id="moveit-包中-controllers"><a href="#moveit-包中-controllers" class="headerlink" title="moveit 包中 controllers"></a><strong>moveit 包中 controllers</strong></h2><img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212732200.png" class="" title="image-20240901212732200">

<p>在 moveit 启动 launch 中通过 joint_state_ns 及 controller_manger 设置了命名空间及名字，<strong>后续会将 &#x2F;joint_states 主题映射为 joint_states_ns 参数指定的主题名</strong>。并在 arm_controller.yaml 中配置 controllers 信息</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212741605.png" class="" title="image-20240901212741605">

<p><code>&lt;controller_manager&gt;_moveit_controller_manager.launch.xml</code></p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212749902.png" class="" title="image-20240901212749902">

<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212754200.png" class="" title="image-20240901212754200">

<p>（该配置文件在单独运行 moveit demo，如 j2n6s300_demo.launch 时，可以使用，其中指定了 controllers: j2n6s300 和 j2n6s300_gripper，无法与 kinova_control.launch 一起使用）</p>
<p>即：gazebo 中 joint_states 主题为 &#x2F;j2n6s300&#x2F;joint_states，而在 moveit 中使用的是 &#x2F;mr2000_kinova&#x2F;joint_states，需进行同步。</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212806141.png" class="" title="image-20240901212806141">

<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212810524.png" class="" title="image-20240901212810524">

<p>注意：arm_controller.yaml 中指定了 controllers 插件前缀为 j2n6s300，与 kinova_control.launch 中设置的相同</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212814153.png" class="" title="image-20240901212814153">



<h1 id="Interactive-Marker-不显示"><a href="#Interactive-Marker-不显示" class="headerlink" title="Interactive Marker 不显示"></a><strong>Interactive Marker 不显示</strong></h1><img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212848740.png" class="" title="image-20240901212848740">

<p>同时，需检查 kinematics.yaml，确保其内容正确。尤其注意 group name 需匹配。</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212857931.png" class="" title="image-20240901212857931">



<h1 id="cartesian-轨迹速度为空"><a href="#cartesian-轨迹速度为空" class="headerlink" title="cartesian 轨迹速度为空"></a><strong>cartesian 轨迹速度为空</strong></h1><p>compute_cartesian_path 轨迹规划成功，但其速度及加速度为空，导致 UR5 driver 无法执行轨迹。</p>
<p>C++ 解决方案参考：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://groups.google.com/forum/#!topic/moveit-users/x5FwalM5ruk">https://groups.google.com/forum/#!topic/moveit-users/x5FwalM5ruk</a></li>
<li><a target="_blank" rel="noopener" href="https://groups.google.com/forum/#!topic/moveit-users/MOoFxy2exT4">https://groups.google.com/forum/#!topic/moveit-users/MOoFxy2exT4</a></li>
</ul>
<p>moveit_commander 解决方案：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">self</span>.robot= moveit_commander.RobotCommander()</span><br><span class="line"><span class="variable language_">self</span>.arm= <span class="variable language_">self</span>.robot.right_arm</span><br><span class="line">...</span><br><span class="line"><span class="variable language_">self</span>.arm.compute_cartesian_path(waypoints, <span class="number">0.01</span>, <span class="number">0.0</span>, <span class="literal">True</span>)</span><br><span class="line">plan= <span class="variable language_">self</span>.arm.retime_trajectory(<span class="variable language_">self</span>.robot.get_current_state(), plan, <span class="number">1.0</span>)</span><br></pre></td></tr></table></figure>



<h1 id="重力力矩-gravity-torques"><a href="#重力力矩-gravity-torques" class="headerlink" title="重力力矩(gravity torques)"></a><strong>重力力矩(gravity torques)</strong></h1><p>通过 DH 参数计算机械手的雅可比矩阵，然后想通过每个关节的扭矩得到笛卡尔力，但是发现输出的每个关节扭矩通常包含重力扭矩。想知道如何知道不同构型下的重力力矩?</p>
<p>在查看API文档的时候也发现在**导纳控制(<strong>admittance control</strong>)**之前需要降低重力力矩，但是不知道在不同的配置下机械手的重力力矩如何得到。</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901212944566.png" class="" title="image-20240901212944566">

<p>API：</p>
<ul>
<li>GetAngularForceGravityFree：获取当前 torque 值，不包含 gravity</li>
<li>GetAngularTorqueGravityEstimation：获取由 gravity 生成的 torque 值</li>
</ul>
<p><strong>joint_torque &#x3D; GetAngularForceGravityFree + GetAngularTorqueGravityEstimation</strong></p>
<p>KinovaComm::getGravityCompensatedTorques 中会调用 GetAngularTorqueGravityEstimation。参考 <a target="_blank" rel="noopener" href="https://github.com/Kinovarobotics/kinova-ros/issues/366">issues#366</a></p>
<h1 id="设置规划时间"><a href="#设置规划时间" class="headerlink" title="设置规划时间"></a><strong>设置规划时间</strong></h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arm.set_planning_time(10)  </span><br></pre></td></tr></table></figure>

<p>​            </p>
<h1 id="选择规划算法"><a href="#选择规划算法" class="headerlink" title="选择规划算法"></a><strong>选择规划算法</strong></h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">planner = <span class="string">&quot;RRTstarkConfigDefault&quot;</span>  <span class="comment"># Asymptotic optimal tree-based planner</span></span><br><span class="line"><span class="comment"># planner = &quot;ESTkConfigDefault&quot;  # Default: tree-based planner</span></span><br><span class="line"><span class="comment"># planner = &quot;RRTConnectConfigDefault&quot;  # Tree-based planner</span></span><br><span class="line"><span class="comment"># planner = &quot;PRMstarkConfigDefault&quot;  # Probabilistic Roadmap planner</span></span><br><span class="line"></span><br><span class="line">move_group.set_planner_id(planner)</span><br></pre></td></tr></table></figure>



<h1 id="spawner-error-too-few-arguments"><a href="#spawner-error-too-few-arguments" class="headerlink" title="spawner: error: too few arguments"></a><strong>spawner: error: too few arguments</strong></h1><p>运行 xxx_moveit_config 包中的 demo_gazebo.launch 时提示该异常</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901213036326.png" class="" title="image-20240901213036326">

<p>经排查，屏蔽 xxx_moveit_config 包中 gazebo.launch 文件中的 ros_controllers.launch 即不再报错</p>
<p>查看 ros_controllers.launch 文件</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Load joint controller configurations from YAML file to parameter server --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find truck_auboi10_moveit_config)/config/ros_controllers.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Load the controllers --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;controller_spawner&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;controller_manager&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawner&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">args</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>负责加载 ros_controllers.yaml 参数，并<strong>启动 controller_manager 中的 spawner 节点。注意：默认 args 为空，因此出现该异常终止。需在参数中添加 controller 信息</strong>，例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- Franka 机械臂 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;controller_spawner&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;controller_manager&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawner&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">args</span>=<span class="string">&quot;$(arg transmission)_joint_trajectory_controller&quot;</span> /&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="comment">&lt;!-- JAKA MiniCobo. 其 controller 信息在 ros_controllers.yaml 中 --&gt;</span>    </span><br><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;controller_spawner&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;controller_manager&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawner&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">args</span>=<span class="string">&quot;joint_state_controller jaka_minicobo_controller&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意，若 ros_controllers.yaml 中 controllers 设置了命名空间，则还需要 ns 参数。例如：</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901213117876.png" class="" title="image-20240901213117876">



<h1 id="Gazebo-无法加载-controller"><a href="#Gazebo-无法加载-controller" class="headerlink" title="Gazebo 无法加载 controller"></a><strong>Gazebo 无法加载 controller</strong></h1><img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901213129021.png" class="" title="image-20240901213129021">

<p>示例中，gazebo 通过 truck_auboi10.yaml 加载 controllers</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find truck_auboi10_gazebo)/config/truck_auboi10.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span>/&gt;</span></span><br><span class="line">                   </span><br><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;controller_spawner&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;controller_manager&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawner&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">  <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">args</span>=<span class="string">&quot;front_aubo_i10_controller</span></span></span><br><span class="line"><span class="string"><span class="tag">                      rear_aubo_i10_controller&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>其中 truck_auboi10.yaml 内容为</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901213150207.png" class="" title="image-20240901213150207">

<p>改写为</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901213158311.png" class="" title="image-20240901213158311">

<p>同时，为 spawner 配置 ns 参数</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;controller_spawner&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;controller_manager&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawner&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">ns</span>=<span class="string">&quot;aubo_i10&quot;</span> <span class="attr">args</span>=<span class="string">&quot;front_aubo_i10_controller</span></span></span><br><span class="line"><span class="string"><span class="tag">                          rear_aubo_i10_controller&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>



<h1 id="RViz-不显示-interactMarker"><a href="#RViz-不显示-interactMarker" class="headerlink" title="RViz 不显示 interactMarker"></a><strong>RViz 不显示 interactMarker</strong></h1><p>检查 kinematics.yaml 参数是否正确加载</p>
<h1 id="Motion-planning-start-tree-could-not-be-initialized"><a href="#Motion-planning-start-tree-could-not-be-initialized" class="headerlink" title="Motion planning start tree could not be initialized!"></a><strong>Motion planning start tree could not be initialized!</strong></h1><p>原因一：SRDF 中指定了 disable_collisions，但 URDF 中无相应 link</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E9%97%AE%E9%A2%98%E8%AE%B0%E5%BD%95/image-20240901213237796.png" class="" title="image-20240901213237796">



<p>原因二：机器人处于碰撞状态</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-Gazebo/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Damon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daemo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Daemo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-Gazebo/" class="post-title-link" itemprop="url">moveit-Gazebo</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-01 21:09:23" itemprop="dateCreated datePublished" datetime="2024-09-01T21:09:23+08:00">2024-09-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-22 14:42:30" itemprop="dateModified" datetime="2024-09-22T14:42:30+08:00">2024-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/" itemprop="url" rel="index"><span itemprop="name">机械臂</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/" itemprop="url" rel="index"><span itemprop="name">MoveIt</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>14 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-Gazebo/image-20240901210956306.png" class="" title="image-20240901210956306">



<p>Driver 负责 moveit 与真实机器人或者 gazebo 通信，真实机器人与 gazebo 仿真的区别就在于：</p>
<ul>
<li>gazebo仿真时，这个 Driver 已经帮我们集成好了，只需要写个 controller 就可以实现通信！</li>
<li>真实机器人中，如果是自己开发的机器人，这个 Driver 需要自己去编写</li>
</ul>
<p>将 MoveIt 下发的 FollowJointTrajectory 比喻成插头，把机器人接收轨迹 Joint Trajectory Controller 和状态反馈部分 Joint State Controller 比喻成插座，所以需要两个控制器来实现 moveit 和 gazebo 的联合仿真。</p>
<p>主要需要构建 ros_control 和 Moveit! 的桥梁：</p>
<ul>
<li>先在 <strong>Moveit! 端配置关节和传感器接口 yaml 文件</strong>，将其加载到 rviz 端</li>
<li>再在<strong>机器人端配置 ros_control 和接口 yaml 文件，将机器人加载到 Gazebo</strong>（通常在 gazebo 包中，并通过 spawn 加载）  </li>
<li>最后同时启动加载有 ros_control 的 Gazebo 和加载有 Moveit 的 rviz，达到联合仿真的目的</li>
</ul>
<p>需要注意：<strong>保持 gazebo 中加载的 controllers 和 moveit 中的 controllers 命名空间一致</strong>。</p>
<p>包含文件：</p>
<ul>
<li>_bringup_moveit.launch：最顶层</li>
<li>_gazebo_world.launch：加载仿真环境</li>
<li>_gazebo_states.launch：启动 joint state controller</li>
<li>_trajectory_controller.launch：启动插补运算的 controller</li>
<li>_moveit_controller_manager.launch.xml：启动 follow joint trajectory 功能</li>
</ul>
<p><strong>1）MoveIt! 端配置</strong></p>
<p>首先确保已通过 MoveIt! Setup Assiant 完成了配置。</p>
<p>测试指令：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">roslaunch ROBOT_moveit_config demo.launch</span></span><br></pre></td></tr></table></figure>



<p><strong>1.1）创建控制器配置文件</strong></p>
<p>创建控制器配置文件。在生成的 MoveIt! config 包的 config 目录下创建 controllers.yaml 文件：</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">joint_state_controller:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">joint_state_controller/JointStateController</span></span><br><span class="line">  <span class="attr">publish_rate:</span> <span class="number">50</span></span><br><span class="line"><span class="attr">controller_list:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">&quot;$(arg prefix)gen3_joint_trajectory_controller&quot;</span></span><br><span class="line">    <span class="attr">action_ns:</span> <span class="string">follow_joint_trajectory</span></span><br><span class="line">    <span class="attr">default:</span> <span class="literal">True</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">FollowJointTrajectory</span></span><br><span class="line">    <span class="attr">joints:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$(arg</span> <span class="string">prefix)joint_1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$(arg</span> <span class="string">prefix)joint_2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$(arg</span> <span class="string">prefix)joint_3</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$(arg</span> <span class="string">prefix)joint_4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$(arg</span> <span class="string">prefix)joint_5</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$(arg</span> <span class="string">prefix)joint_6</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">$(arg</span> <span class="string">prefix)joint_7</span></span><br></pre></td></tr></table></figure>



<p><strong>1.2）修改启动文件</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;dof&quot;</span> <span class="attr">default</span>=<span class="string">&quot;7&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">default</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Set the param that trajectory_execution_manager needs to find the controller plugin --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;moveit_controller_manager&quot;</span> </span></span><br><span class="line"><span class="tag">      <span class="attr">value</span>=<span class="string">&quot;moveit_simple_controller_manager/MoveItSimpleControllerManager&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- The rest of the params are specific to this plugin --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find gen3_move_it_config)/config/$(arg dof)dof/controllers.yaml&quot;</span> <span class="attr">subst_value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>





<p><strong>2）示例一</strong></p>
<p>① 创建 URDF 模型</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">robot</span> <span class="attr">name</span>=<span class="string">&quot;&lt;robot_name&gt;&quot;</span> <span class="attr">xmlns:xacro</span>=<span class="string">&quot;http://www.ros.org/wiki/xacro&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">name</span>=<span class="string">&quot;world&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;fixed&quot;</span> <span class="attr">type</span>=<span class="string">&quot;fixed&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">parent</span> <span class="attr">link</span>=<span class="string">&quot;world&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">child</span> <span class="attr">link</span>=<span class="string">&quot;base_link&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- 为 Joints 添加传动 Transmissions for ROS Control --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">xacro:macro</span> <span class="attr">name</span>=<span class="string">&quot;transmission_block&quot;</span> <span class="attr">params</span>=<span class="string">&quot;joint_name&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">transmission</span> <span class="attr">name</span>=<span class="string">&quot;tran1&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">type</span>&gt;</span>transmission_interface/SimpleTransmission<span class="tag">&lt;/<span class="name">type</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">joint</span> <span class="attr">name</span>=<span class="string">&quot;$&#123;joint_name&#125;&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hardwareInterface</span>&gt;</span>hardware_interface/PositionJointInterface<span class="tag">&lt;/<span class="name">hardwareInterface</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">joint</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">actuator</span> <span class="attr">name</span>=<span class="string">&quot;motor1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hardwareInterface</span>&gt;</span>hardware_interface/PositionJointInterface<span class="tag">&lt;/<span class="name">hardwareInterface</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mechanicalReduction</span>&gt;</span>1<span class="tag">&lt;/<span class="name">mechanicalReduction</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">actuator</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">transmission</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">xacro:macro</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">xacro:transmission_block</span> <span class="attr">joint_name</span>=<span class="string">&quot;joint1&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">xacro:transmission_block</span> <span class="attr">joint_name</span>=<span class="string">&quot;joint2&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">xacro:transmission_block</span> <span class="attr">joint_name</span>=<span class="string">&quot;joint3&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">xacro:transmission_block</span> <span class="attr">joint_name</span>=<span class="string">&quot;joint4&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">xacro:transmission_block</span> <span class="attr">joint_name</span>=<span class="string">&quot;joint5&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">xacro:transmission_block</span> <span class="attr">joint_name</span>=<span class="string">&quot;joint6&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- 添加 Gazebo 控制器插件 ros_control plugin --&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">gazebo</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;gazebo_ros_control&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_control.so&quot;</span>&gt;</span>    </span><br><span class="line">        <span class="tag">&lt;<span class="name">robotNamespace</span>&gt;</span>/robot_name<span class="tag">&lt;/<span class="name">robotNamespace</span>&gt;</span>      </span><br><span class="line">        <span class="tag">&lt;<span class="name">robotSimType</span>&gt;</span>gazebo_ros_control/DefaultRobotHWSim<span class="tag">&lt;/<span class="name">robotSimType</span>&gt;</span>      </span><br><span class="line">        <span class="tag">&lt;<span class="name">legacyModeNS</span>&gt;</span>true<span class="tag">&lt;/<span class="name">legacyModeNS</span>&gt;</span>    </span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">robot</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>② 生成配置文件</p>
<p>参考 MoveIt! Setup Assistant 使用说明生成配置文件。</p>
<p>③ 创建 Gazebo 功能包</p>
<p>新建 _gazebo 包，在其中创建 config 和 launch 目录</p>
<p>添加 config 文件</p>
<ul>
<li><strong>robot_name_gazebo_joint_states.yaml</strong>：定义 joint_state_controller，用于监控机器人实时状态</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">robot_name:</span></span><br><span class="line">  <span class="comment"># Publish all joint states -----------------------------------</span></span><br><span class="line">  <span class="attr">joint_state_controller:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">joint_state_controller/JointStateController</span></span><br><span class="line">    <span class="attr">publish_rate:</span> <span class="number">50</span></span><br></pre></td></tr></table></figure>



<ul>
<li><strong>robot_name_trajectory_control.yaml</strong>：用于明确控制器接口接收哪些关节信息，需与 URDF 模型对应，此外，还包含每个关节的 PID 参数</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">robot_name:</span></span><br><span class="line">  <span class="attr">arm_joint_controller:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">&quot;position_controllers/JointTrajectoryController&quot;</span></span><br><span class="line">    <span class="attr">joints:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint3</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint5</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint6</span></span><br><span class="line"></span><br><span class="line">    <span class="attr">gains:</span></span><br><span class="line">      <span class="attr">joint1:</span>   &#123;<span class="attr">p:</span> <span class="number">1000.0</span>, <span class="attr">i:</span> <span class="number">0.0</span>, <span class="attr">d:</span> <span class="number">0.1</span>, <span class="attr">i_clamp:</span> <span class="number">0.0</span>&#125;</span><br><span class="line">      <span class="attr">joint2:</span>   &#123;<span class="attr">p:</span> <span class="number">1000.0</span>, <span class="attr">i:</span> <span class="number">0.0</span>, <span class="attr">d:</span> <span class="number">0.1</span>, <span class="attr">i_clamp:</span> <span class="number">0.0</span>&#125;</span><br><span class="line">      <span class="attr">joint3:</span>   &#123;<span class="attr">p:</span> <span class="number">1000.0</span>, <span class="attr">i:</span> <span class="number">0.0</span>, <span class="attr">d:</span> <span class="number">0.1</span>, <span class="attr">i_clamp:</span> <span class="number">0.0</span>&#125;</span><br><span class="line">      <span class="attr">joint4:</span>   &#123;<span class="attr">p:</span> <span class="number">1000.0</span>, <span class="attr">i:</span> <span class="number">0.0</span>, <span class="attr">d:</span> <span class="number">0.1</span>, <span class="attr">i_clamp:</span> <span class="number">0.0</span>&#125;</span><br><span class="line">      <span class="attr">joint5:</span>   &#123;<span class="attr">p:</span> <span class="number">1000.0</span>, <span class="attr">i:</span> <span class="number">0.0</span>, <span class="attr">d:</span> <span class="number">0.1</span>, <span class="attr">i_clamp:</span> <span class="number">0.0</span>&#125;</span><br><span class="line">      <span class="attr">joint6:</span>   &#123;<span class="attr">p:</span> <span class="number">1000.0</span>, <span class="attr">i:</span> <span class="number">0.0</span>, <span class="attr">d:</span> <span class="number">0.1</span>, <span class="attr">i_clamp:</span> <span class="number">0.0</span>&#125;</span><br></pre></td></tr></table></figure>



<p>创建 launch 文件</p>
<ul>
<li>robot_name_trajectory_controller.launch：将 <strong>robot_name_trajectory_control.yaml</strong> 配置文件加载到参数服务器，再调用 spawner 根据参数文件内容启动 <strong>arm_joint_controller</strong>，该控制器完成每个轴的插补运算，并让每个轴运动</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find robot_name_gazebo)/config/robot_name_trajectory_control.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;arm_controller_spawner&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;controller_manager&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawner&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">ns</span>=<span class="string">&quot;/robot_name&quot;</span> <span class="attr">args</span>=<span class="string">&quot;arm_joint_controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li>robot_name_gazebo_states.launch：加载 joint_state_controller</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 将关节控制器的配置参数加载到参数服务器中 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find robot_name_gazebo)/config/robot_name_gazebo_joint_states.yaml&quot;</span> <span class="attr">command</span>=<span class="string">&quot;load&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;joint_controller_spawner&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;controller_manager&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawner&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span></span></span><br><span class="line"><span class="tag">          <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">ns</span>=<span class="string">&quot;/robot_name&quot;</span> <span class="attr">args</span>=<span class="string">&quot;joint_state_controller&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 运行robot_state_publisher节点，发布tf  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;robot_state_publisher&quot;</span> <span class="attr">type</span>=<span class="string">&quot;robot_state_publisher&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;/joint_states&quot;</span> <span class="attr">to</span>=<span class="string">&quot;/robot_name/joint_states&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li>robot_name_gazebo_world.launch</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- these are the arguments you can pass this launch file, for example paused:=true --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;paused&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;use_sim_time&quot;</span> <span class="attr">default</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gui&quot;</span> <span class="attr">default</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;headless&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">default</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- We resume the logic in empty_world.launch --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find gazebo_ros)/launch/empty_world.launch&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg debug)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;gui&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg gui)&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;paused&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg paused)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;use_sim_time&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg use_sim_time)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;headless&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg headless)&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Load the URDF into the ROS Parameter Server --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;robot_description&quot;</span> <span class="attr">command</span>=<span class="string">&quot;$(find xacro)/xacro --inorder &#x27;$(find robot_name_description)/urdf/robot_name.xacro&#x27;&quot;</span> /&gt;</span> </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- Run a python script to the send a service call to gazebo_ros to spawn a URDF robot --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;urdf_spawner&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;gazebo_ros&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawn_model&quot;</span> <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">args</span>=<span class="string">&quot;-urdf -model robot_name -param robot_description&quot;</span>/&gt;</span> </span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>



<ul>
<li>robot_name_bringup_moveit.launch</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">&lt;!-- Launch Gazebo  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find robot_name_gazebo)/launch/robot_name_gazebo_world.launch&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ros_control arm launch file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find robot_name_gazebo)/launch/robot_name_gazebo_states.launch&quot;</span> /&gt;</span>   </span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- ros_control trajectory control dof arm launch file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find robot_name_gazebo)/launch/robot_name_trajectory_controller.launch&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- moveit launch file --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find robot_name_moveit_config)/launch/moveit_planning_execution.launch&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Damon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daemo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Daemo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">moveit-使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-01 20:46:31" itemprop="dateCreated datePublished" datetime="2024-09-01T20:46:31+08:00">2024-09-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-22 14:42:30" itemprop="dateModified" datetime="2024-09-22T14:42:30+08:00">2024-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/" itemprop="url" rel="index"><span itemprop="name">机械臂</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/" itemprop="url" rel="index"><span itemprop="name">MoveIt</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>15k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>28 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>MoveIt! 使用流程：</p>
<ul>
<li>创建 URDF 模型</li>
<li>配置：使用 MoveIt! Setup Assistant 生成配置文件</li>
<li>添加机器人控制器插件 controller</li>
<li>MoveIt! 控制机器人运动</li>
</ul>
<p>MoveIt! 输入用户指令，比如起始位置，输出轨迹数据，每个点通过位置速度加速度描述，为了通过话题发出来，还需要一个 <strong>Follow Joint Trajectory</strong> 功能，通过通信接口发给机器人，机器人还需要对轨迹进行<strong>精插补</strong>，再驱动电机同步运动。机器人控制器还需要将每个电机的状态数据反馈给 MoveIt! 来确定机器人是否到达指定位置，这样完成一个闭环。</p>
<h1 id="RobotModel-与-RobotState"><a href="#RobotModel-与-RobotState" class="headerlink" title="RobotModel 与 RobotState"></a>RobotModel 与 RobotState</h1><blockquote>
<p>介绍通过 C++ API 使用 MoveIt 中的运动学(kinematics)。包括正运动学求解、逆运动学求解以及雅可比矩阵求解。</p>
</blockquote>
<p><a target="_blank" rel="noopener" href="http://docs.ros.org/noetic/api/moveit_core/html/classmoveit_1_1core_1_1RobotModel.html"><strong>RobotModel</strong></a> 和 <a target="_blank" rel="noopener" href="http://docs.ros.org/noetic/api/moveit_core/html/classmoveit_1_1core_1_1RobotState.html"><strong>RobotState</strong></a> 是访问机器人运动学的两个核心类。</p>
<p><strong>RobotModel 类包含所有 links 和 joints 之间的关系，包括从 URDF 加载的关节限制属性</strong>。RobotModel 还将机器人的 links 和 joints 分开到 SRDF 中定义的规划组中。</p>
<p><strong>RobotState 类包含机器人在某一时刻的信息</strong>，存储关节<strong>位置、速度、加速度向量</strong>等。这些信息可以用来获得机器人的运动学信息，依赖于它的当前状态，例如末端执行器的 Jacobian。</p>
<p>RobotState 还包含辅助函数，用于根据末端执行器位置(笛卡尔姿态)设置手臂位置和计算笛卡尔轨迹。</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">roslaunch moveit_tutorials robot_model_and_robot_state_tutorial.launch</span></span><br></pre></td></tr></table></figure>

<p>运行输出：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[ INFO] : Loading robot model &#x27;panda&#x27;...</span><br><span class="line">[ INFO] : Model frame: world</span><br><span class="line">[ INFO] : Joint panda_joint1: 0.000000</span><br><span class="line">[ INFO] : Joint panda_joint2: 0.000000</span><br><span class="line">[ INFO] : Joint panda_joint3: 0.000000</span><br><span class="line">[ INFO] : Joint panda_joint4: -1.570800</span><br><span class="line">[ INFO] : Joint panda_joint5: 0.000000</span><br><span class="line">[ INFO] : Joint panda_joint6: 0.000000</span><br><span class="line">[ INFO] : Joint panda_joint7: 0.000000</span><br><span class="line">[ INFO] : Current state is not valid</span><br><span class="line">[ INFO] : Current state is valid</span><br><span class="line">[ INFO] : Translation:</span><br><span class="line">0.166555</span><br><span class="line">0.244931</span><br><span class="line">0.408155</span><br><span class="line"></span><br><span class="line">[ INFO] : Rotation:</span><br><span class="line"> -0.119873   0.251145  -0.960498</span><br><span class="line"> -0.735699   -0.67209 -0.0839164</span><br><span class="line"> -0.666617   0.696578   0.265332</span><br><span class="line"></span><br><span class="line">[ INFO] : Joint panda_joint1: -0.887238</span><br><span class="line">[ INFO] : Joint panda_joint2: -1.243671</span><br><span class="line">[ INFO] : Joint panda_joint3: 1.581131</span><br><span class="line">[ INFO] : Joint panda_joint4: -2.349818</span><br><span class="line">[ INFO] : Joint panda_joint5: -0.471360</span><br><span class="line">[ INFO] : Joint panda_joint6: 0.152547</span><br><span class="line">[ INFO] : Joint panda_joint7: -0.966377</span><br><span class="line">[ INFO] : Jacobian:</span><br><span class="line">   -0.244931    0.0474647   -0.0235218     0.043507   -0.0249171    0.0993464  6.07153e-18</span><br><span class="line">    0.166555   -0.0582701    0.0984654     0.281663   -0.0230651   -0.0965234 -3.81639e-17</span><br><span class="line">           0    0.0847139    -0.268771    0.0624676   -0.0974941  -0.00255494  8.67362e-18</span><br><span class="line">           0      0.77533    -0.598064     0.210935     0.970394     0.241357    -0.960498</span><br><span class="line">           0     0.631556     0.734214    -0.242591   -0.0646234     0.223418   -0.0839164</span><br><span class="line">           1  4.89619e-12     0.321323     0.946919     -0.23272     0.944368     0.265332</span><br></pre></td></tr></table></figure>



<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>实例化 <a target="_blank" rel="noopener" href="http://docs.ros.org/melodic/api/moveit_ros_planning/html/classrobot__model__loader_1_1RobotModelLoader.html">RobotModelLoader</a> 对象，该对象会在 ROS parameter 中查找 robot description 参数，并构建 RobotModel。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">robot_model_loader::RobotModelLoader <span class="title">robot_model_loader</span><span class="params">(<span class="string">&quot;robot_description&quot;</span>)</span></span>;</span><br><span class="line">robot_model::RobotModelPtr kinematic_model = robot_model_loader.<span class="built_in">getModel</span>();</span><br><span class="line"><span class="built_in">ROS_INFO</span>(<span class="string">&quot;Model frame: %s&quot;</span>, kinematic_model-&gt;<span class="built_in">getModelFrame</span>().<span class="built_in">c_str</span>());</span><br></pre></td></tr></table></figure>

<p>然后，使用 RobotModel 构建 RobotState 对象来维护机器人的配置。</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">robot_state::RobotStatePtr <span class="title">kinematic_state</span><span class="params">(<span class="keyword">new</span> robot_state::RobotState(kinematic_model))</span></span>;</span><br><span class="line">kinematic_state-&gt;<span class="built_in">setToDefaultValues</span>(); <span class="comment">// 将各 joints 设置为默认值</span></span><br><span class="line"><span class="comment">// 根据 group name 获取 JointModelGroup 信息</span></span><br><span class="line"><span class="type">const</span> robot_state::JointModelGroup* joint_model_group = </span><br><span class="line">                    kinematic_model-&gt;<span class="built_in">getJointModelGroup</span>(<span class="string">&quot;panda_arm&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">const</span> std::vector&lt;std::string&gt;&amp; joint_names = </span><br><span class="line">                    joint_model_group-&gt;<span class="built_in">getVariableNames</span>();</span><br></pre></td></tr></table></figure>

<p>获取当前关节值</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">std::vector&lt;<span class="type">double</span>&gt; joint_values;</span><br><span class="line">kinematic_state-&gt;<span class="built_in">copyJointGroupPositions</span>(joint_model_group, joint_values);</span><br><span class="line"><span class="keyword">for</span> (std::<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; joint_names.<span class="built_in">size</span>(); ++i)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Joint %s: %f&quot;</span>, joint_names[i].<span class="built_in">c_str</span>(), joint_values[i]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关节限制，setJointGroupPositions() 本身不会强制执行 joint limit，但是调用 enforceBounds()可以实现</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Set one joint in the Panda arm outside its joint limit */</span></span><br><span class="line">joint_values[<span class="number">0</span>] = <span class="number">5.57</span>;</span><br><span class="line">kinematic_state-&gt;<span class="built_in">setJointGroupPositions</span>(joint_model_group, joint_values);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Check whether any joint is outside its joint limits */</span></span><br><span class="line"><span class="built_in">ROS_INFO_STREAM</span>(<span class="string">&quot;Current state is &quot;</span> &lt;&lt; (kinematic_state-&gt;<span class="built_in">satisfiesBounds</span>() ? <span class="string">&quot;valid&quot;</span> : <span class="string">&quot;not valid&quot;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Enforce the joint limits for this state and check again*/</span></span><br><span class="line">kinematic_state-&gt;<span class="built_in">enforceBounds</span>();</span><br><span class="line"><span class="built_in">ROS_INFO_STREAM</span>(<span class="string">&quot;Current state is &quot;</span> &lt;&lt; (kinematic_state-&gt;<span class="built_in">satisfiesBounds</span>() ? <span class="string">&quot;valid&quot;</span> : <span class="string">&quot;not valid&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>正运动学(Forward Kinematics)</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对一组随机的关节值计算正运动学</span></span><br><span class="line">kinematic_state-&gt;<span class="built_in">setToRandomPositions</span>(joint_model_group);</span><br><span class="line"><span class="comment">// 此例中，要找到机器人 panda_arm 组中最远端的 panda_link8 的位姿</span></span><br><span class="line"><span class="type">const</span> Eigen::Isometry3d&amp; end_effector_state = </span><br><span class="line">                kinematic_state-&gt;<span class="built_in">getGlobalLinkTransform</span>(<span class="string">&quot;panda_link8&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Print end-effector pose. Remember that this is in the model frame */</span></span><br><span class="line"><span class="built_in">ROS_INFO_STREAM</span>(<span class="string">&quot;Translation: \n&quot;</span> &lt;&lt; end_effector_state.<span class="built_in">translation</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="built_in">ROS_INFO_STREAM</span>(<span class="string">&quot;Rotation: \n&quot;</span> &lt;&lt; end_effector_state.<span class="built_in">rotation</span>() &lt;&lt; <span class="string">&quot;\n&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>逆运动学(Inverse Kinematics，即：IK)。要求解 IK，需要以下数据：</p>
<ul>
<li>期望的 end-effector 的位姿：前面计算得到的 end_effector_state</li>
<li>超时时间：0.1</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> timeout = <span class="number">0.1</span>;</span><br><span class="line"><span class="type">bool</span> found_ik = kinematic_state-&gt;<span class="built_in">setFromIK</span>(joint_model_group, </span><br><span class="line">                                        end_effector_state, timeout);</span><br><span class="line">                                        </span><br><span class="line"><span class="comment">// 打印 IK 解</span></span><br><span class="line"><span class="keyword">if</span> (found_ik) &#123;</span><br><span class="line">  kinematic_state-&gt;<span class="built_in">copyJointGroupPositions</span>(joint_model_group, joint_values);</span><br><span class="line">  <span class="keyword">for</span> (std::<span class="type">size_t</span> i = <span class="number">0</span>; i &lt; joint_names.<span class="built_in">size</span>(); ++i) &#123;</span><br><span class="line">    <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Joint %s: %f&quot;</span>, joint_names[i].<span class="built_in">c_str</span>(), joint_values[i]);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="built_in">ROS_INFO</span>(<span class="string">&quot;Did not find IK solution&quot;</span>);</span><br><span class="line">&#125;                                        </span><br></pre></td></tr></table></figure>

<p>获取 Jacobian</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Eigen::Vector3d <span class="title">reference_point_position</span><span class="params">(<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>)</span></span>;</span><br><span class="line">Eigen::MatrixXd jacobian;</span><br><span class="line">kinematic_state-&gt;<span class="built_in">getJacobian</span>(joint_model_group,</span><br><span class="line">                             kinematic_state-&gt;<span class="built_in">getLinkModel</span>(joint_model_group-&gt;<span class="built_in">getLinkModelNames</span>().<span class="built_in">back</span>()),</span><br><span class="line">                             reference_point_position, jacobian);</span><br><span class="line"><span class="built_in">ROS_INFO_STREAM</span>(<span class="string">&quot;Jacobian: \n&quot;</span> &lt;&lt; jacobian &lt;&lt; <span class="string">&quot;\n&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>launch 文件。要运行代码，launch 文件中需要完成以下任务：</p>
<ul>
<li>加载 URDF 和 SRDF 到参数服务器</li>
<li>将 MoveIt Setup Assistant 生成的 kinematics_solver 配置放到 ROS 参数服务器上</li>
</ul>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;launch&gt;</span><br><span class="line">  &lt;include file=<span class="string">&quot;$(find panda_moveit_config)/launch/planning_context.launch&quot;</span>&gt;</span><br><span class="line">    &lt;arg name=<span class="string">&quot;load_robot_description&quot;</span> value=<span class="string">&quot;true&quot;</span>/&gt;</span><br><span class="line">  &lt;/include&gt;</span><br><span class="line"></span><br><span class="line">  &lt;node name=<span class="string">&quot;robot_model_and_robot_state_tutorial&quot;</span></span><br><span class="line">        pkg=<span class="string">&quot;moveit_tutorials&quot;</span></span><br><span class="line">        type=<span class="string">&quot;robot_model_and_robot_state_tutorial&quot;</span></span><br><span class="line">        respawn=<span class="string">&quot;false&quot;</span> output=<span class="string">&quot;screen&quot;</span>&gt;</span><br><span class="line">    &lt;rosparam command=<span class="string">&quot;load&quot;</span></span><br><span class="line">              file=<span class="string">&quot;$(find panda_moveit_config)/config/kinematics.yaml&quot;</span>/&gt;</span><br><span class="line">  &lt;/node&gt;</span><br><span class="line">&lt;/launch&gt;</span><br></pre></td></tr></table></figure>

<p>其中，plan_context.launch 中会加载 URDF 和 SRDF。</p>
<h2 id="调试-RobotState"><a href="#调试-RobotState" class="headerlink" title="调试 RobotState"></a>调试 RobotState</h2><p>可使用命令行工具帮助调试 robot state</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rosrun moveit_ros_planning moveit_print_planning_model_info</span></span><br></pre></td></tr></table></figure>



<h1 id="Controllers配置"><a href="#Controllers配置" class="headerlink" title="Controllers配置"></a>Controllers配置</h1><p> moveit_controller_manager 参数，在 xxx_moveit_controller_manager.launch.xml 中设置。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- Define the controller manager plugin to use for trajectory execution --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;moveit_controller_manager&quot;</span> <span class="attr">default</span>=<span class="string">&quot;moveit_simple_controller_manager/MoveItSimpleControllerManager&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;moveit_controller_manager&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg moveit_controller_manager)&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- loads controller list to the param server --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">rosparam</span> <span class="attr">file</span>=<span class="string">&quot;$(find mr2000_aubo_i5_moveit_config)/config/ros_controllers.yaml&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>trajectory_execution_manager.cpp 中读取该参数</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (controller_manager_loader_)</span><br><span class="line">&#123;</span><br><span class="line">    std::string controller;</span><br><span class="line">    <span class="keyword">if</span> (!node_handle_.<span class="built_in">getParam</span>(<span class="string">&quot;moveit_controller_manager&quot;</span>, controller))</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">// 获取 moveit_core 支持的所有插件的名称列表  </span></span><br><span class="line">      <span class="type">const</span> std::vector&lt;std::string&gt;&amp; classes = controller_manager_loader_-&gt;<span class="built_in">getDeclaredClasses</span>();</span><br><span class="line">      <span class="keyword">if</span> (classes.<span class="built_in">size</span>() == <span class="number">1</span>)</span><br><span class="line">      &#123;</span><br><span class="line">        controller = classes[<span class="number">0</span>];</span><br><span class="line">        <span class="built_in">ROS_WARN_NAMED</span>(name_,</span><br><span class="line">                       <span class="string">&quot;Parameter &#x27;~moveit_controller_manager&#x27; is not specified but only one &quot;</span></span><br><span class="line">                       <span class="string">&quot;matching plugin was found: &#x27;%s&#x27;. Using that one.&quot;</span>,</span><br><span class="line">                       controller.<span class="built_in">c_str</span>());</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span></span><br><span class="line">        <span class="built_in">ROS_FATAL_NAMED</span>(name_, <span class="string">&quot;Parameter &#x27;~moveit_controller_manager&#x27; not specified. This is needed to &quot;</span></span><br><span class="line">                               <span class="string">&quot;identify the plugin to use for interacting with controllers. No paths can &quot;</span></span><br><span class="line">                               <span class="string">&quot;be executed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!controller.<span class="built_in">empty</span>())</span><br><span class="line">      <span class="keyword">try</span></span><br><span class="line">      &#123;</span><br><span class="line">        controller_manager_ = controller_manager_loader_-&gt;<span class="built_in">createUniqueInstance</span>(controller);</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">catch</span> (pluginlib::PluginlibException&amp; ex)</span><br><span class="line">      &#123;</span><br><span class="line">        <span class="built_in">ROS_FATAL_STREAM_NAMED</span>(name_,</span><br><span class="line">                               <span class="string">&quot;Exception while loading controller manager &#x27;&quot;</span> &lt;&lt; controller &lt;&lt; <span class="string">&quot;&#x27;: &quot;</span> &lt;&lt; ex.<span class="built_in">what</span>());</span><br><span class="line">      &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>若设置了 <code>moveit_controller_manager</code> 参数，则以该参数指定的插件实例化 ***<code>controller_manger_</code>***。否则使用 moveit_core 支持的插件列表中的第一个。</p>
<p><code>controller_manger_loader_</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">controller_manager_loader_.<span class="built_in">reset</span>(<span class="keyword">new</span> pluginlib::<span class="built_in">ClassLoader</span>&lt;moveit_controller_manager::MoveItControllerManager&gt;(</span><br><span class="line">        <span class="string">&quot;moveit_core&quot;</span>, <span class="string">&quot;moveit_controller_manager::MoveItControllerManager&quot;</span>));</span><br></pre></td></tr></table></figure>

<p>其中，<code>pluginlib::ClassLoader</code> 先获取指定包 moveit_core 的所有支持的插件的 xml 文件路径，等价于使用以下指令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rospack plugins --attrib=plugin moveit_core</span></span><br></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rospack plugins --attrib=plugin moveit_core</span></span><br><span class="line">aubo_kinematics /home/robuster/grasp_ws/src/aubo_robot/aubo_kinematics/aubo_moveit_plugins.xml</span><br><span class="line">moveit_ros_control_interface /opt/ros/melodic/share/moveit_ros_control_interface/moveit_core_plugins.xml</span><br><span class="line">moveit_ros_planning /opt/ros/melodic/share/moveit_ros_planning/planning_request_adapters_plugin_description.xml</span><br><span class="line">moveit_planners_chomp /opt/ros/melodic/share/moveit_planners_chomp/chomp_interface_plugin_description.xml</span><br><span class="line">industrial_trajectory_filters /opt/ros/melodic/share/industrial_trajectory_filters/planning_request_adapters_plugin_description.xml</span><br><span class="line">moveit_kinematics /opt/ros/melodic/share/moveit_kinematics/kdl_kinematics_plugin_description.xml</span><br><span class="line">moveit_kinematics /opt/ros/melodic/share/moveit_kinematics/lma_kinematics_plugin_description.xml</span><br><span class="line">moveit_kinematics /opt/ros/melodic/share/moveit_kinematics/srv_kinematics_plugin_description.xml</span><br><span class="line">moveit_kinematics /opt/ros/melodic/share/moveit_kinematics/cached_ik_kinematics_plugin_description.xml</span><br><span class="line">moveit_planners_ompl /opt/ros/melodic/share/moveit_planners_ompl/ompl_interface_plugin_description.xml</span><br><span class="line">moveit_fake_controller_manager /opt/ros/melodic/share/moveit_fake_controller_manager/moveit_fake_controller_manager_plugin_description.xml</span><br><span class="line">moveit_simple_controller_manager /opt/ros/melodic/share/moveit_simple_controller_manager/moveit_simple_controller_manager_plugin_description.xml</span><br><span class="line">moveit_core /opt/ros/melodic/share/moveit_core/collision_detector_fcl_description.xml</span><br></pre></td></tr></table></figure>

<p>然后，调用 <code>determineAvailableClasses</code> 根据这些 plugin.xml 文件返回可用的 classes，并赋值给 <code>classes_available_</code> 变量</p>
<h1 id="运动学约束-Kinematic-constraints"><a href="#运动学约束-Kinematic-constraints" class="headerlink" title="运动学约束(Kinematic constraints)"></a><strong>运动学约束(Kinematic constraints)</strong></h1><p>MoveIt! 内置的约束为运动学约束，包括：</p>
<ul>
<li>Position constraints：限制 link 的运动区域</li>
<li>Orientation constraints：限制 link 的运动方向</li>
<li>Visibility constraints：限制 link 上某点在某区域的可见性</li>
<li>Joint constraints：限制 joint 的运动范围</li>
<li>User-specified constraints：用户自定义的约束条件</li>
</ul>
<h1 id="调试"><a href="#调试" class="headerlink" title="调试"></a><strong>调试</strong></h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">调试 RobotState</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rosrun moveit_ros_planning moveit_print_planning_model_info</span> </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">调试 Planning Scene Monitor</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rosrun moveit_ros_planning moveit_print_planning_scene_info</span>  </span><br><span class="line"><span class="meta prompt_"></span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">MoveIt Commander Scripting</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rosrun moveit_commander moveit_commander_cmdline.py</span>  </span><br></pre></td></tr></table></figure>

<p>​                            </p>
<h1 id="主题及服务"><a href="#主题及服务" class="headerlink" title="主题及服务"></a><strong>主题及服务</strong></h1><p><strong>move_group 节点通过 ROS</strong> <strong>topics</strong> <strong>和</strong> <strong>actions</strong> <strong>与机器人通信</strong>，获取机器人状态、传感器数据等</p>
<h2 id="follow-joint-trajectory"><a href="#follow-joint-trajectory" class="headerlink" title="follow_joint_trajectory"></a><strong>follow_joint_trajectory</strong></h2><p>action，MoveIt! 最终规划发布的 action 消息，机器人控制器接收该消息后控制机器人完成运动。这就需要在 MoveIt!端配置一个控制器插件，实现该接口的功能。该插件的配置在 MoveIt! 配置包中已经实现，可以查看配置包中的 controllers.yaml 文件：</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E4%BD%BF%E7%94%A8/image-20240901204813263.png" class="" title="image-20240901204813263">

<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E4%BD%BF%E7%94%A8/image-20240901204818625.png" class="" title="image-20240901204818625">

<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E4%BD%BF%E7%94%A8/image-20240901204823140.png" class="" title="image-20240901204823140">



<h2 id="trajectory-execution-event"><a href="#trajectory-execution-event" class="headerlink" title="trajectory_execution_event"></a><strong>trajectory_execution_event</strong></h2><p>该主题为轨迹执行事件，在接收到 stop() 请求时，会发布 stop 事件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">/pickup/cancel</span><br><span class="line">/pickup/feedback</span><br><span class="line">/pickup/goal</span><br><span class="line">/pickup/result</span><br><span class="line">/pickup/statu</span><br><span class="line">/place/cancel</span><br><span class="line">/place/feedback</span><br><span class="line">/place/goal</span><br><span class="line">/place/result</span><br><span class="line">/place/status</span><br><span class="line">/planning_scene</span><br><span class="line">/planning_scene_world</span><br></pre></td></tr></table></figure>





<h2 id="action"><a href="#action" class="headerlink" title="action"></a><strong>action</strong></h2><h3 id="move-group"><a href="#move-group" class="headerlink" title="move_group"></a><strong>move_group</strong></h3><p><code>go()</code> 函数通过调用 <code>move()/async_move()</code>，其中 <code>async_move()</code> 实际是调用：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">move(<span class="literal">False</span>) <span class="comment"># 即：wait 参数为 False, 非阻塞</span></span><br></pre></td></tr></table></figure>

<p><code>move()</code> 接口通过 actionlib 向 move_group 发送 <strong>moveit_msgs::MoveGroupGoal</strong>  类型 goal。相关主题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/move_group/goal</span><br><span class="line">/move_group/status</span><br><span class="line">/move_group/feedback</span><br><span class="line">/move_group/result</span><br><span class="line">/move_group/cancel</span><br></pre></td></tr></table></figure>

<h3 id="execute-trajectory"><a href="#execute-trajectory" class="headerlink" title="execute_trajectory"></a><strong>execute_trajectory</strong></h3><p><code>execute()</code> 接口，通过 actionlib 向 <strong>execute_trajectory</strong> 发送 <code>moveit_msgs::ExecuteTrajectoryGoal</code> 类型 goal。相关主题：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/execute_trajectory/goal</span><br><span class="line">/execute_trajectory/status</span><br><span class="line">/execute_trajectory/feedback</span><br><span class="line">/execute_trajectory/result</span><br><span class="line">/execute_trajectory/cancel</span><br></pre></td></tr></table></figure>

<p>&#x2F;attached_collision_object</p>
<p>&#x2F;collision_object</p>
<h1 id="ACM"><a href="#ACM" class="headerlink" title="ACM"></a><strong>ACM</strong></h1><p><a target="_blank" rel="noopener" href="http://docs.ros.org/melodic/api/moveit_core/html/classcollision__detection_1_1AllowedCollisionMatrix.html">AllowedCollisionMatrix</a> - 碰撞免检矩阵。ACM 提供了一种机制来告诉 collision world 忽略某些对象之间的碰撞。</p>
<h1 id="ROS-I"><a href="#ROS-I" class="headerlink" title="ROS-I"></a><strong>ROS-I</strong></h1><p>将 ROS 功能应用到工业生产过程中，为工业机器人提供工业级 ROS 应用开发支持。</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E4%BD%BF%E7%94%A8/image-20240901205228107.png" class="" title="image-20240901205228107">



<h1 id="Planner-评价标准"><a href="#Planner-评价标准" class="headerlink" title="Planner 评价标准"></a><strong>Planner 评价标准</strong></h1><ul>
<li>Optimality：最优性。路径最短，规划速度最快等</li>
<li>Complete：完备性。在有限时间内解决所有有解的问题</li>
</ul>
<p>调试</p>
<p>依次打印轨迹中每个关节的位置及时间，可生成各关节的运动曲线，来判断运动稳定性</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">trajectory_msgs::JointTrajectory::_points_type::iterator iter;</span><br><span class="line">trajectory = as_.<span class="built_in">acceptNewGoal</span>()-&gt;trajectory;</span><br><span class="line"><span class="keyword">for</span>(iter= trajectory.points.<span class="built_in">begin</span>(); iter!=trajectory.points.<span class="built_in">end</span>(); iter++) </span><br><span class="line">    cout&lt;&lt;iter-&gt;positions[<span class="number">0</span>]&lt;&lt;” ”;</span><br><span class="line">cout&lt;&lt;endl;</span><br><span class="line"><span class="keyword">for</span>(iter=trajectory.points.<span class="built_in">begin</span>(); iter!=trajectory.points.<span class="built_in">end</span>(); iter++)</span><br><span class="line">    cout&lt;&lt;iter-&gt;positions[<span class="number">1</span>]&lt;&lt;””;</span><br><span class="line">cout&lt;&lt;endl;</span><br><span class="line"><span class="keyword">for</span>(iter=trajectory.points.<span class="built_in">begin</span>(); iter!=trajectory.points.<span class="built_in">end</span>(); iter++)</span><br><span class="line">    cout&lt;&lt;iter-&gt;time_from_start&lt;&lt;” ”;</span><br></pre></td></tr></table></figure>

<p><img src="D:\workspace\my-notes\blog\source_posts\机械臂\MoveIt\moveit-使用\image-20240901205303338.png" alt="image-20240901205303338"></p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E4%BD%BF%E7%94%A8/image-20240901205308525.png" class="" title="image-20240901205308525">

<h1 id="time-from-start"><a href="#time-from-start" class="headerlink" title="time_from_start"></a><strong>time_from_start</strong></h1><p>轨迹规划完成后，通过 IPTP 来添加时间、速度等信息。首先 </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">trajectory_processing::IterativeParabolicTimeParameterization time_param;</span><br><span class="line">time_param.<span class="built_in">computeTimeStamps</span>(rt, <span class="number">1.0</span>);</span><br><span class="line">rt.<span class="built_in">getRobotTrajectoryMsg</span>(res.solution) <span class="comment">// res.solution 即生成的轨迹(解决方案)</span></span><br></pre></td></tr></table></figure>

<p><code>computeTimeStamps</code> 接口中根据轨迹点数计算相邻轨迹点之间的时间差 time_diff 数组。初始时，time_diff 数组中的时间差均为 0.0。然后添加速度约束，即：根据允许的最大速度计算相邻轨迹点 t_min, 若 t_min 大于该点的 time_diff，则将该点 time_diff 设置为 t_min；再添加加速度约束。添加速度约束和加速度约束的过程实际是更新 time_diff。</p>
<p>更新完 time_diff 之后，再根据 <strong>time_diff</strong> 数组通过 <strong>duration_from_previous_</strong> 设置轨迹点的 time_from_start(实际就是通过 time_diff 来依次计算各轨迹点的 time_from_start)</p>
<h1 id="Plan-Execute"><a href="#Plan-Execute" class="headerlink" title="Plan &amp; Execute"></a>Plan &amp; Execute</h1><p>RViz MontionPlanning 界面提供 Plan&#x2F;Execute&#x2F;Plan&amp;Execute 按钮。</p>
<p>Plan: 规划轨迹</p>
<p>Execute: 按规划的轨迹控制机械臂</p>
<p>Plan 按键对应 <em><strong>MotionPlanningFrame::computePlanButtonClicked()</strong></em> 接口。根据 <em>use_cartesian_path</em> 参数，调用 <strong>computeCartesianPlan()</strong> 或 <em><strong>computeJointSpacePlan()</strong></em> 接口规划轨迹，规划完成后，触发 <em><strong>planningFinished()</strong></em> 信号。</p>
<p>Execute 按键对应 <em><strong>MotionPlanningFrame::computeExecuteButtonClicked()</strong></em> 接口，该接口调用 <em><strong>execute(current_plan_)</strong></em> 执行轨迹，执行完成后，调用 <em><strong>onFinishedExecution(bool success)</strong></em> 更新状态。</p>
<p><em>Plan &amp; Execute 按键对应</em>  <em><strong>MotionPlanningFrame::computePlanAndExecuteButtonClicked()</strong></em> 接口，该接口调用 <em><strong>computeCartesianPlan()</strong></em> 进行轨迹规划，然后调用 <em><strong>computeExecuteButtonClicked()</strong></em> 接口执行轨迹。</p>
<p>若选择 “Use Cartesian Path”，则使用笛卡尔轨迹规划(move_group_-&gt;<strong>computeCartesianPath</strong>(…))，否则使用 joint space 轨迹规划(move_group_-&gt;<strong>plan</strong>(*current_plan_))。</p>
<p>plan 规划完成后，会在 <strong>&#x2F;move_group&#x2F;goal</strong> 主题发布规划信息给 move_group 节点；点击 Execute 执行轨迹，实际是通过 <strong>&#x2F;execute_trajectory&#x2F;goal</strong> 主题发布轨迹信息给 move_group 节点</p>
<p><strong>rotbotNamespace</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;gazebo_ros_control&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_control.so&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">robotNamespace</span>&gt;</span>aubo_i5<span class="tag">&lt;/<span class="name">robotNamespace</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;robotNamespace&gt;/&lt;/robotNamespace&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p>gazebo_ros_control 插件指定 robotNamespace 后，<strong>controller_manager 服务会添加上该命名空间</strong>，变为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/&lt;robotNamespace&gt;/controller_manager</span><br></pre></td></tr></table></figure>



<p>因此，所有 gazebo controllers 都应在该命名空间中，才能正常加载。此时才可通过 controller_manager&#x2F;list_controllers 服务进行查看。</p>
<p><strong>robtoNamespace 与 controller_spawner 节点的 ns 参数，以及 _gazebo_control.yaml 中的命名空间需要一致</strong>。同样，moveit 中加载的 controller(通常位于 _moveit_config&#x2F;config&#x2F;congrollers.yaml 中) 也要确保命名空间一致。</p>
<p>注意：controller_manager 相关 services 不受 ns 参数影响，只与 robotNamespace 相关。例如：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># robotNamespace 参数设置为 aubo_i5</span><br><span class="line"><span class="tag">&lt;<span class="name">gazebo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">name</span>=<span class="string">&quot;gazebo_ros_control&quot;</span> <span class="attr">filename</span>=<span class="string">&quot;libgazebo_ros_control.so&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">robotNamespace</span>&gt;</span>aubo_i5<span class="tag">&lt;/<span class="name">robotNamespace</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- &lt;robotNamespace&gt;/&lt;/robotNamespace&gt; --&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">gazebo</span>&gt;</span></span><br><span class="line"></span><br><span class="line"># controller_manager 节点 ns 参数设置为 aubo_i5_test</span><br><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">name</span>=<span class="string">&quot;controller_spawner&quot;</span> <span class="attr">pkg</span>=<span class="string">&quot;controller_manager&quot;</span> <span class="attr">type</span>=<span class="string">&quot;spawner&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">respawn</span>=<span class="string">&quot;false&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">ns</span>=<span class="string">&quot;aubo_i5_test&quot;</span> </span></span><br><span class="line"><span class="tag">    <span class="attr">args</span>=<span class="string">&quot;joint_state_controller&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>



<p>提示如下错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">: Could not load controller &#x27;joint_state_controller&#x27; because the type was not specified. Did you load the controller configuration on the parameter server (namespace: &#x27;/aubo_i5/joint_state_controller&#x27;)?</span><br></pre></td></tr></table></figure>



<h1 id="Joystick"><a href="#Joystick" class="headerlink" title="Joystick"></a><strong>Joystick</strong></h1><p>启动 moveit 程序，RViz 中使能 “External Comm”</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E4%BD%BF%E7%94%A8/image-20240917200217931.png" class="" title="image-20240917200217931">

<p>启动 joystick_control.launch</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">roslaunch &lt;YOURROBOT&gt;_moveit_config joystick_control.launch</span></span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">或手动指定遥控器端口</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">roslaunch YOURROBOT_moveit_config joystick_control.launch dev:=/dev/input/js1</span></span><br></pre></td></tr></table></figure>

<p>该脚本可读取三种类型的 joy sticks</p>
<ul>
<li>XBox360</li>
<li>PS3 USB 接口</li>
<li>PS3 蓝牙接口</li>
<li>Arctic USB Wireless Gamepad</li>
</ul>
<p>请注意，只有对其所 有End executor 父组都具有 IK 求解器的规划组才能工作。</p>
<p>此外，需在 rviz 中添加 &#x2F;rviz&#x2F;moveit&#x2F;move_marker&#x2F;goal_link_tcp 主题才能控制，否则提示</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-%E4%BD%BF%E7%94%A8/image-20240917200304420.png" class="" title="image-20240917200304420">

<p>按键映射</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>PS3 Controller</th>
<th>Xbox Controller</th>
</tr>
</thead>
<tbody><tr>
<td>+-x&#x2F;y</td>
<td>left analog stick</td>
<td>left analog stick</td>
</tr>
<tr>
<td>+-z</td>
<td>L2&#x2F;R2</td>
<td>LT&#x2F;RT</td>
</tr>
<tr>
<td>+-yaw</td>
<td>L1&#x2F;R1</td>
<td>LB&#x2F;RB</td>
</tr>
<tr>
<td>+-roll</td>
<td>left&#x2F;right</td>
<td>left&#x2F;right</td>
</tr>
<tr>
<td>+-pitch</td>
<td>up&#x2F;down</td>
<td>up&#x2F;down</td>
</tr>
<tr>
<td>change planning group</td>
<td>select&#x2F;start</td>
<td>Y&#x2F;A</td>
</tr>
<tr>
<td>change end effector</td>
<td>triangle&#x2F;cross</td>
<td>back&#x2F;start</td>
</tr>
<tr>
<td>plan</td>
<td>square</td>
<td>X</td>
</tr>
<tr>
<td>execute</td>
<td>circle</td>
<td>B</td>
</tr>
</tbody></table>
<p>RViz 中可添加 “Pose” 订阅 “&#x2F;joy_pose” 来显示 joystick 的输出位置。</p>
<p>[FATAL] [&#x2F;moveit_joy-592]: Check if you started movegroups. Exiting.</p>
<p>需定义 end_effector </p>
<p>延时较大，待调试</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-Realtime%20Arm%20Servoing/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Damon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daemo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Daemo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-Realtime%20Arm%20Servoing/" class="post-title-link" itemprop="url">Servoing</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-01 20:26:39" itemprop="dateCreated datePublished" datetime="2024-09-01T20:26:39+08:00">2024-09-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-22 14:42:30" itemprop="dateModified" datetime="2024-09-22T14:42:30+08:00">2024-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/" itemprop="url" rel="index"><span itemprop="name">机械臂</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/" itemprop="url" rel="index"><span itemprop="name">MoveIt</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>653</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>1 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>向启用 ros 的机器人发送实时伺服命令。伺服节点的一些不错的功能是奇异处理和碰撞检查，以防止操作员破坏机器人。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">git clone -b 1.2.7 https://github.com/ros-industrial/universal_robot</span><br><span class="line"></span><br><span class="line">rosdep install -y --from-paths . --ignore-src --rosdistro $ROS_DISTRO</span><br><span class="line"></span><br><span class="line">cd ~/ws_moveit/</span><br><span class="line">catkin build</span><br><span class="line">source devel/setup.bash</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">roslaunch ur_gazebo ur5.launch</span><br><span class="line">roslaunch ur5_moveit_config ur5_moveit_planning_execution.launch sim:=true</span><br><span class="line">roslaunch ur5_moveit_config moveit_rviz.launch config:=true</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">rosservice call /controller_manager/switch_controller &quot;start_controllers: [&#x27;joint_group_position_controller&#x27;]</span><br><span class="line">stop_controllers: [&#x27;arm_controller&#x27;]</span><br><span class="line">strictness: 0</span><br><span class="line">start_asap: false</span><br><span class="line">timeout: 0.0&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch moveit_servo spacenav_cpp.launch</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-MoveGroup-Interface/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Damon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daemo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Daemo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-MoveGroup-Interface/" class="post-title-link" itemprop="url">moveit-MoveGroup-Interface</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-01 20:17:12" itemprop="dateCreated datePublished" datetime="2024-09-01T20:17:12+08:00">2024-09-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-22 14:42:30" itemprop="dateModified" datetime="2024-09-22T14:42:30+08:00">2024-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/" itemprop="url" rel="index"><span itemprop="name">机械臂</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/" itemprop="url" rel="index"><span itemprop="name">MoveIt</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>11k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>21 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>在 MoveIt 中，最简单的用户接口通过 <code>MoveGroupInterface</code> 类。为用户可能想要执行的大多数操作提供了易于使用的功能，特别是设置关节或位姿目标、创建运动计划、移动机器人、将对象添加到环境中以及从机器人上附加&#x2F;分离对象。此接口通过 ROS topic、service 和 action <strong>与 MoveGroup 节点进行通信</strong>。</p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a><strong>测试</strong></h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">roslaunch panda_moveit_config demo.launch</span> </span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">roslaunch moveit_tutorials move_group_interface_tutorial.launch</span></span><br></pre></td></tr></table></figure>

<p>启动后，点击 rviz 中 RvizVisualToolsGui 插件中的 next 依次执行设定好的操作</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-MoveGroup-Interface/image-20240901201434422.png" class="" title="image-20240901201434422">

<p>包括：</p>
<ul>
<li>移动到前方的 pose goal</li>
<li>移动到侧方的 joint goal</li>
<li>在保持末端执行器水平的同时，将手臂移回到一个新的 pose goal</li>
<li>沿着笛卡尔路径移动手臂(一个下、右、上、左的三角形)</li>
</ul>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-MoveGroup-Interface/image-20240901201518555.png" class="" title="image-20240901201518555">

<ul>
<li>在手臂右侧添加一个 box object</li>
<li>移动到 pose goal，同时避开障碍物(box object)</li>
</ul>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-MoveGroup-Interface/image-20240901201556603.png" class="" title="image-20240901201556603">

<ul>
<li>object 附着到 wrist(颜色切换为 紫&#x2F;橙&#x2F;绿)</li>
<li>object 从 wrist 断开(颜色变回绿色)</li>
<li>移除 box object</li>
</ul>
<h1 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a><strong>源码分析</strong></h1><p><code>moveit_tutorials/doc/move_group_interface/src</code></p>
<p>MoveIt! 对 planning groups 进行操作，并将他们存储在 JointModelGroup 类对象中。在 MoveIt! 中，术语 planning groups 和 joint model group 可以互换使用</p>
<p>① 设置</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// panda_arm 为要操作的 planning group. panda_arm 已在 moveit setup assistant 中设置 </span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> std::string PLANNING_GROUP = <span class="string">&quot;panda_arm&quot;</span>; moveit::<span class="function">planning_interface::MoveGroupInterface <span class="title">move_group</span><span class="params">(PLANNING_GROUP)</span></span>; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 将使用 PlanningSceneInterface 类对象来添加/删除 collision object </span></span><br><span class="line">moveit::planning_interface::PlanningSceneInterface planning_scene_interface; </span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用 raw pointers 引用 planning group 以提高性能.  </span></span><br><span class="line"><span class="comment">// 注意：planning groups 和 joint model group 可以互换使用 </span></span><br><span class="line"><span class="type">const</span> robot_state::JointModelGroup* joint_model_group =    move_group.<span class="built_in">getCurrentState</span>()-&gt;<span class="built_in">getJointModelGroup</span>(PLANNING_GROUP); </span><br></pre></td></tr></table></figure>

<p>​           </p>
<p>② 可视化</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// MoveItVisualTools 提供了许多在 RViz 中可视化对象、机器人和轨迹的功能，</span></span><br><span class="line"><span class="comment">// 以及调试工具，如 step-by-step introspection of a script</span></span><br><span class="line"><span class="keyword">namespace</span> rvt = rviz_visual_tools;</span><br><span class="line"><span class="function">moveit_visual_tools::MoveItVisualTools <span class="title">visual_tools</span><span class="params">(<span class="string">&quot;panda_link0&quot;</span>)</span></span>;</span><br><span class="line">visual_tools.<span class="built_in">deleteAllMarkers</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 远程控制是一种内省工具，允许用户通过 RViz 中的按钮/快捷键逐步执行高级脚本</span></span><br><span class="line">visual_tools.<span class="built_in">loadRemoteControl</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// RViz提供了许多类型的标记，该例中将使用文本、柱面和球体</span></span><br><span class="line">Eigen::Isometry3d text_pose = Eigen::Isometry3d::<span class="built_in">Identity</span>();</span><br><span class="line">text_pose.<span class="built_in">translation</span>().<span class="built_in">z</span>() = <span class="number">1.75</span>; <span class="comment">// 位于机器人上方</span></span><br><span class="line">visual_tools.<span class="built_in">publishText</span>(text_pose, <span class="string">&quot;MoveGroupInterface Demo&quot;</span>, </span><br><span class="line">                            rvt::WHITE, rvt::XLARGE);</span><br><span class="line">                            </span><br><span class="line"><span class="comment">// Batch publishing 用于减少发送到 RViz 的大块可视化消息的数量            </span></span><br><span class="line">visual_tools.<span class="built_in">trigger</span>();   </span><br></pre></td></tr></table></figure>



<p>③ 获取基础信息                    </p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取机器人的参考坐标系</span></span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;Planning frame: %s&quot;</span>, </span><br><span class="line">                move_group.<span class="built_in">getPlanningFrame</span>().<span class="built_in">c_str</span>());</span><br><span class="line">                </span><br><span class="line"><span class="comment">// 获取 group 中 end-effort link 的名字</span></span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;End effector link: %s&quot;</span>, </span><br><span class="line">                move_group.<span class="built_in">getEndEffectorLink</span>().<span class="built_in">c_str</span>());                </span><br><span class="line">                </span><br><span class="line"><span class="comment">// 获取所有 groups</span></span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;Available Planning Groups:&quot;</span>);</span><br><span class="line">std::<span class="built_in">copy</span>(move_group.<span class="built_in">getJointModelGroupNames</span>().<span class="built_in">begin</span>(), </span><br><span class="line">            move_group.<span class="built_in">getJointModelGroupNames</span>().<span class="built_in">end</span>(),</span><br><span class="line">              std::<span class="built_in">ostream_iterator</span>&lt;std::string&gt;(std::cout, <span class="string">&quot;, &quot;</span>));  </span><br></pre></td></tr></table></figure>



<p>④ 启动 demo</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">visual_tools.<span class="built_in">prompt</span>(<span class="string">&quot;Press &#x27;next&#x27; in the RvizVisualToolsGui window </span></span><br><span class="line"><span class="string">                    to start the demo&quot;</span>);</span><br></pre></td></tr></table></figure>

<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-MoveGroup-Interface/image-20240901202128716.png" class="" title="image-20240901202128716">



<p>⑤ Planning to a pose goal</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">geometry_msgs::Pose target_pose1;</span><br><span class="line">target_pose<span class="number">1.</span>orientation.w = <span class="number">1.0</span>;</span><br><span class="line">target_pose<span class="number">1.</span>position.x = <span class="number">0.28</span>;</span><br><span class="line">target_pose<span class="number">1.</span>position.y = <span class="number">-0.2</span>;</span><br><span class="line">target_pose<span class="number">1.</span>position.z = <span class="number">0.5</span>;</span><br><span class="line">move_group.<span class="built_in">setPoseTarget</span>(target_pose1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 调用规划器进行规划并可视化。注意，此处只是在计划，不会实际移动机器人</span></span><br><span class="line">moveit::planning_interface::MoveGroupInterface::Plan my_plan;</span><br><span class="line"><span class="type">bool</span> success = (move_group.<span class="built_in">plan</span>(my_plan) == </span><br><span class="line">        moveit::planning_interface::MoveItErrorCode::SUCCESS);</span><br><span class="line"></span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;Visualizing plan 1 (pose goal) %s&quot;</span>, </span><br><span class="line">        success ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;FAILED&quot;</span>);</span><br></pre></td></tr></table></figure>

<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-MoveGroup-Interface/image-20240901202152977.png" class="" title="image-20240901202152977">



<p>⑥ 可视化规划的轨迹</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;Visualizing plan 1 as trajectory line&quot;</span>);</span><br><span class="line">visual_tools.<span class="built_in">publishAxisLabeled</span>(target_pose1, <span class="string">&quot;pose1&quot;</span>);</span><br><span class="line">visual_tools.<span class="built_in">publishText</span>(text_pose, <span class="string">&quot;Pose Goal&quot;</span>, rvt::WHITE, rvt::XLARGE);</span><br><span class="line">visual_tools.<span class="built_in">publishTrajectoryLine</span>(my_plan.trajectory_, joint_model_group);</span><br><span class="line">visual_tools.<span class="built_in">trigger</span>();</span><br><span class="line">visual_tools.<span class="built_in">prompt</span>(</span><br><span class="line">    <span class="string">&quot;Press &#x27;next&#x27; in the RvizVisualToolsGui window to continue the demo&quot;</span>);</span><br></pre></td></tr></table></figure>



<p>⑦ 运动到 pose goal</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* Uncomment below line when working with a real robot. 阻塞函数，需要控制器</span></span><br><span class="line"><span class="comment">    处于活动状态并上报轨迹执行成功 */</span></span><br><span class="line"><span class="comment">/* move_group.move(); */</span></span><br></pre></td></tr></table></figure>



<p>⑧ planning to a joint-space goal</p>
<p>关节空间的规划结果会覆盖掉上文的工作空间规划结果</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 获取机器人当前状态. RobotState 中包含当前的 position/velocity/acceleration</span></span><br><span class="line">moveit::core::RobotStatePtr current_state = move_group.<span class="built_in">getCurrentState</span>();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取当前 group 的所有 joint 值</span></span><br><span class="line">std::vector&lt;<span class="type">double</span>&gt; joint_group_positions;</span><br><span class="line">current_state-&gt;<span class="built_in">copyJointGroupPositions</span>(</span><br><span class="line">        joint_model_group, joint_group_positions);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改某个 joint 的值, 然后进行规划</span></span><br><span class="line">joint_group_positions[<span class="number">0</span>] = <span class="number">-1.0</span>;  <span class="comment">// radians</span></span><br><span class="line">move_group.<span class="built_in">setJointValueTarget</span>(joint_group_positions);</span><br><span class="line">success = (move_group.<span class="built_in">plan</span>(my_plan) == </span><br><span class="line">        moveit::planning_interface::MoveItErrorCode::SUCCESS);</span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;Visualizing plan 2 (joint space goal) %s&quot;</span>, </span><br><span class="line">        success ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;FAILED&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 轨迹可视化</span></span><br><span class="line">visual_tools.<span class="built_in">deleteAllMarkers</span>();</span><br><span class="line">visual_tools.<span class="built_in">publishText</span>(text_pose, <span class="string">&quot;Joint Space Goal&quot;</span>, </span><br><span class="line">    rvt::WHITE, rvt::XLARGE);</span><br><span class="line">visual_tools.<span class="built_in">publishTrajectoryLine</span>(my_plan.trajectory_, joint_model_group);</span><br><span class="line">visual_tools.<span class="built_in">trigger</span>();</span><br><span class="line">visual_tools.<span class="built_in">prompt</span>(</span><br><span class="line">    <span class="string">&quot;Press &#x27;next&#x27; in the RvizVisualToolsGui window to continue the demo&quot;</span>);</span><br></pre></td></tr></table></figure>



<p>⑨ 路径约束下的规划</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义路径约束</span></span><br><span class="line">moveit_msgs::OrientationConstraint ocm;</span><br><span class="line">ocm.link_name = <span class="string">&quot;panda_link7&quot;</span>;</span><br><span class="line">ocm.header.frame_id = <span class="string">&quot;panda_link0&quot;</span>;</span><br><span class="line">ocm.orientation.w = <span class="number">1.0</span>;</span><br><span class="line">ocm.absolute_x_axis_tolerance = <span class="number">0.1</span>;</span><br><span class="line">ocm.absolute_y_axis_tolerance = <span class="number">0.1</span>;</span><br><span class="line">ocm.absolute_z_axis_tolerance = <span class="number">0.1</span>;</span><br><span class="line">ocm.weight = <span class="number">1.0</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为 group 设置约束</span></span><br><span class="line">moveit_msgs::Constraints test_constraints;</span><br><span class="line">test_constraints.orientation_constraints.<span class="built_in">push_back</span>(ocm);</span><br><span class="line">move_group.<span class="built_in">setPathConstraints</span>(test_constraints);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为规划组设定新的起始位姿，且该新位姿要满足路径约束</span></span><br><span class="line"><span class="function">robot_state::RobotState <span class="title">start_state</span><span class="params">(*move_group.getCurrentState())</span></span>;</span><br><span class="line">geometry_msgs::Pose start_pose2;</span><br><span class="line">start_pose<span class="number">2.</span>orientation.w = <span class="number">1.0</span>;</span><br><span class="line">start_pose<span class="number">2.</span>position.x = <span class="number">0.55</span>;</span><br><span class="line">start_pose<span class="number">2.</span>position.y = <span class="number">-0.05</span>;</span><br><span class="line">start_pose<span class="number">2.</span>position.z = <span class="number">0.8</span>;</span><br><span class="line"><span class="comment">// 如果start_pose2对应的规划组joint_model_group是 chain,且有解算器可用，</span></span><br><span class="line"><span class="comment">// 则可通过 moveit 中自带的逆运动学求解器进行计算得到规划组中各关节位置值，</span></span><br><span class="line"><span class="comment">// 前提是设置的start_pose2要在运动模型的参考系中</span></span><br><span class="line">start_state.<span class="built_in">setFromIK</span>(joint_model_group, start_pose2);</span><br><span class="line"><span class="comment">// 由于改变了规划组的起始位姿，需要将设定的位姿作为规划组的启动状态</span></span><br><span class="line">move_group.<span class="built_in">setStartState</span>(start_state);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 规划</span></span><br><span class="line">move_group.<span class="built_in">setPoseTarget</span>(target_pose1);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 使用约束进行规划可能会很慢，因为每个样本都必须调用反向运动学求解器，</span></span><br><span class="line"><span class="comment">// 因此，将规划时间从默认的 5 秒增加到 10 秒，以保证规划器完成规划</span></span><br><span class="line">move_group.<span class="built_in">setPlanningTime</span>(<span class="number">10.0</span>);</span><br><span class="line"></span><br><span class="line">success = (move_group.<span class="built_in">plan</span>(my_plan) == </span><br><span class="line">    moveit::planning_interface::MoveItErrorCode::SUCCESS);</span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;Visualizing plan 3 (constraints) %s&quot;</span>, </span><br><span class="line">    success ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;FAILED&quot;</span>);</span><br><span class="line">...</span><br><span class="line"><span class="comment">// 规划完成，清除约束</span></span><br><span class="line">move_group.<span class="built_in">clearPathConstraints</span>();    </span><br></pre></td></tr></table></figure>



<p>⑩ Cartesian Paths</p>
<p>可以通过指定一组末端执行器要经过的 waypoints 来直接规划一条笛卡尔路径。注意，从上面的新 start state 开始。初始姿态(start state)不需要添加到路径点列表中，但添加它可以帮助可视化</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 将起始位姿 start_pose2、三个waypoints 依次添加到 waypoints 数组中</span></span><br><span class="line">std::vector&lt;geometry_msgs::Pose&gt; waypoints;</span><br><span class="line">waypoints.<span class="built_in">push_back</span>(start_pose2);</span><br><span class="line"></span><br><span class="line">geometry_msgs::Pose target_pose3 = start_pose2;</span><br><span class="line"></span><br><span class="line">target_pose<span class="number">3.</span>position.z -= <span class="number">0.2</span>;</span><br><span class="line">waypoints.<span class="built_in">push_back</span>(target_pose3);  <span class="comment">// down</span></span><br><span class="line"></span><br><span class="line">target_pose<span class="number">3.</span>position.y -= <span class="number">0.2</span>;</span><br><span class="line">waypoints.<span class="built_in">push_back</span>(target_pose3);  <span class="comment">// right</span></span><br><span class="line"></span><br><span class="line">target_pose<span class="number">3.</span>position.z += <span class="number">0.2</span>;</span><br><span class="line">target_pose<span class="number">3.</span>position.y += <span class="number">0.2</span>;</span><br><span class="line">target_pose<span class="number">3.</span>position.x -= <span class="number">0.2</span>;</span><br><span class="line">waypoints.<span class="built_in">push_back</span>(target_pose3);  <span class="comment">// up and left</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 笛卡尔运动经常需要慢一些的动作，如接近和撤退抓握动作。</span></span><br><span class="line"><span class="comment">// 此例中，演示了如何通过每个关节的最大速度的比例因子来降低机器人手臂的速度。</span></span><br><span class="line"><span class="comment">// 注意，这不是末端执行器点的速度。</span></span><br><span class="line">move_group.<span class="built_in">setMaxVelocityScalingFactor</span>(<span class="number">0.1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 对笛卡尔路径以 1cm 的分辨率进行插值，因此将笛卡尔平移最大步长设置为 0.01</span></span><br><span class="line">moveit_msgs::RobotTrajectory trajectory;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> jump_threshold = <span class="number">0.0</span>;</span><br><span class="line"><span class="type">const</span> <span class="type">double</span> eef_step = <span class="number">0.01</span>;</span><br><span class="line"><span class="comment">// 计算笛卡尔路径. </span></span><br><span class="line"><span class="comment">//   waypoints: 路径需经过的点</span></span><br><span class="line"><span class="comment">//   eef_step: 步长</span></span><br><span class="line"><span class="comment">//   jump_threshold: 机器人位姿空间中距离的变化的阈值。操作真实硬件时，若将该</span></span><br><span class="line"><span class="comment">//      参数设置为 0，可能会导致冗余连接发送大量不可预测的动作</span></span><br><span class="line"><span class="type">double</span> fraction = move_group.<span class="built_in">computeCartesianPath</span>(waypoints, eef_step, </span><br><span class="line">                                    jump_threshold, trajectory);</span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Visualizing plan 4 (Cartesian path) (%.2f%% acheived)&quot;</span>, </span><br><span class="line">    fraction * <span class="number">100.0</span>);</span><br></pre></td></tr></table></figure>



<p>⑪ 添加&#x2F;删除及attach&#x2F;deattach object</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个碰撞目标</span></span><br><span class="line">moveit_msgs::CollisionObject collision_object;</span><br><span class="line">collision_object.header.frame_id = move_group.<span class="built_in">getPlanningFrame</span>();</span><br><span class="line">collision_object.id = <span class="string">&quot;box1&quot;</span>; <span class="comment">// 设置 ID</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 向环境中添加 box</span></span><br><span class="line">shape_msgs::SolidPrimitive primitive;</span><br><span class="line">primitive.type = primitive.BOX;</span><br><span class="line">primitive.dimensions.<span class="built_in">resize</span>(<span class="number">3</span>);</span><br><span class="line">primitive.dimensions[<span class="number">0</span>] = <span class="number">0.4</span>;</span><br><span class="line">primitive.dimensions[<span class="number">1</span>] = <span class="number">0.1</span>;</span><br><span class="line">primitive.dimensions[<span class="number">2</span>] = <span class="number">0.4</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义该 box 的位姿</span></span><br><span class="line">geometry_msgs::Pose box_pose;</span><br><span class="line">box_pose.orientation.w = <span class="number">1.0</span>;</span><br><span class="line">box_pose.position.x = <span class="number">0.4</span>;</span><br><span class="line">box_pose.position.y = <span class="number">-0.2</span>;</span><br><span class="line">box_pose.position.z = <span class="number">1.0</span>;</span><br><span class="line">collision_object.primitives.<span class="built_in">push_back</span>(primitive);</span><br><span class="line">collision_object.primitive_poses.<span class="built_in">push_back</span>(box_pose);</span><br><span class="line">collision_object.operation = collision_object.ADD;</span><br><span class="line"></span><br><span class="line">std::vector&lt;moveit_msgs::CollisionObject&gt; collision_objects;</span><br><span class="line">collision_objects.<span class="built_in">push_back</span>(collision_object);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 添加到 world 中</span></span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;Add an object into the world&quot;</span>);</span><br><span class="line">planning_scene_interface.<span class="built_in">addCollisionObjects</span>(collision_objects);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 规划一条避开障碍物的轨迹</span></span><br><span class="line">move_group.<span class="built_in">setStartState</span>(*move_group.<span class="built_in">getCurrentState</span>());</span><br><span class="line">geometry_msgs::Pose another_pose;</span><br><span class="line">another_pose.orientation.w = <span class="number">1.0</span>;</span><br><span class="line">another_pose.position.x = <span class="number">0.4</span>;</span><br><span class="line">another_pose.position.y = <span class="number">-0.4</span>;</span><br><span class="line">another_pose.position.z = <span class="number">0.9</span>;</span><br><span class="line">move_group.<span class="built_in">setPoseTarget</span>(another_pose);</span><br><span class="line">success = (move_group.<span class="built_in">plan</span>(my_plan) == </span><br><span class="line">    moveit::planning_interface::MoveItErrorCode::SUCCESS);</span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, </span><br><span class="line">    <span class="string">&quot;Visualizing plan 5 (pose goal move around cuboid) %s&quot;</span>, </span><br><span class="line">    success ? <span class="string">&quot;&quot;</span> : <span class="string">&quot;FAILED&quot;</span>);</span><br><span class="line">    </span><br><span class="line"><span class="comment">// attach 碰撞目标到机器人</span></span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;Attach the object to the robot&quot;</span>);</span><br><span class="line">move_group.<span class="built_in">attachObject</span>(collision_object.id);</span><br><span class="line"></span><br><span class="line"><span class="comment">// deattch</span></span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;Detach the object from the robot&quot;</span>);</span><br><span class="line">move_group.<span class="built_in">detachObject</span>(collision_object.id);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 删除碰撞目标</span></span><br><span class="line"><span class="built_in">ROS_INFO_NAMED</span>(<span class="string">&quot;tutorial&quot;</span>, <span class="string">&quot;Remove the object from the world&quot;</span>);</span><br><span class="line">std::vector&lt;std::string&gt; object_ids;</span><br><span class="line">object_ids.<span class="built_in">push_back</span>(collision_object.id);</span><br><span class="line">planning_scene_interface.<span class="built_in">removeCollisionObjects</span>(object_ids);</span><br></pre></td></tr></table></figure>



<h1 id="约束条件"><a href="#约束条件" class="headerlink" title="约束条件"></a><strong>约束条件</strong></h1><h2 id="moveit-msgs-Constraints"><a href="#moveit-msgs-Constraints" class="headerlink" title="moveit_msgs::Constraints"></a><strong>moveit_msgs::Constraints</strong></h2><p>包含 方向约束、关节约束、位置约束、可见性约束。</p>
<p>例一：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">// 构建目标点约束. 使用关节约束</span></span><br><span class="line"> moveit_msgs::Constraints pose_goal =</span><br><span class="line">      kinematic_constraints::<span class="built_in">constructGoalConstraints</span>(</span><br><span class="line">              <span class="string">&quot;panda_link8&quot;</span>,  <span class="comment">// link名称</span></span><br><span class="line">              pose, <span class="comment">// 目标点坐标</span></span><br><span class="line">              tolerance_pose, <span class="comment">// 位置允许误差</span></span><br><span class="line">              tolerance_angle <span class="comment">// 转角允许误差</span></span><br><span class="line">      ); </span><br><span class="line">req.group_name = PLANNING_GROUP;            <span class="comment">//设置运动规划组名称</span></span><br><span class="line">req.goal_constraints.<span class="built_in">push_back</span>(pose_goal);     </span><br></pre></td></tr></table></figure>



<p>其中，</p>
<ul>
<li><strong>tolerance_pose</strong>：与 PositionConstraint 的目标区域关联的球体的维度。赋值给 PositionConstraint shape_msgs&#x2F;SolidPrimitive 中的成员变量 <strong>dimensions</strong>。</li>
<li><strong>tolerance_angle</strong>：方向约束 OrientationConstraint 的绝对公差的值。会将 absolute_x_axis_tolerance、 absolute_y_axis_tolerance、absolute_z_axis_tolerance 均赋值为该参数</li>
</ul>
<p>此处构建的约束将包含一个 PositionConstraint 和一个 OrientationConstraint。球体将用于表示 PositionConstraint 的约束区域。</p>
<p>例二：</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">pose.pose.position.x = <span class="number">0.32</span>;</span><br><span class="line">pose.pose.position.y = <span class="number">-0.25</span>;</span><br><span class="line">pose.pose.position.z = <span class="number">0.65</span>;</span><br><span class="line">pose.pose.orientation.w = <span class="number">1.0</span>;</span><br><span class="line"><span class="comment">// 位置约束</span></span><br><span class="line">moveit_msgs::Constraints pose_goal_2 =</span><br><span class="line">  kinematic_constraints::<span class="built_in">constructGoalConstraints</span>(</span><br><span class="line">      <span class="string">&quot;panda_link8&quot;</span>, </span><br><span class="line">      pose, </span><br><span class="line">      tolerance_pose, </span><br><span class="line">      tolerance_angle);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* Now, let&#x27;s try to move to this new pose goal*/</span></span><br><span class="line">req.goal_constraints.<span class="built_in">clear</span>();</span><br><span class="line">req.goal_constraints.<span class="built_in">push_back</span>(pose_goal_2);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* But, let&#x27;s impose a path constraint on the motion.</span></span><br><span class="line"><span class="comment"> Here, we are asking for the end-effector to stay level*/</span></span><br><span class="line"><span class="comment">//方法是：定义一个四元数，只设定旋转位姿，然后将其设置为约束。</span></span><br><span class="line">geometry_msgs::QuaternionStamped quaternion;</span><br><span class="line">quaternion.header.frame_id = <span class="string">&quot;panda_link0&quot;</span>;</span><br><span class="line">quaternion.quaternion.w = <span class="number">1.0</span>;</span><br><span class="line">req.path_constraints = </span><br><span class="line">    kinematic_constraints::<span class="built_in">constructGoalConstraints</span>(</span><br><span class="line">        <span class="string">&quot;panda_link8&quot;</span>, </span><br><span class="line">        quaternion</span><br><span class="line">    );</span><br></pre></td></tr></table></figure>

<p>其中，quaternion 参数赋值给 OrientationConstraint 中的 orientation</p>
<p>例三</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/* 添加约束，使末端执行器保持水平 */</span></span><br><span class="line">geometry_msgs::QuaternionStamped quaternion;</span><br><span class="line">quaternion.header.frame_id = <span class="string">&quot;torso_lift_link&quot;</span>;</span><br><span class="line">quaternion.quaternion.w = <span class="number">1.0</span>;</span><br><span class="line">req.path_constraints = kinematic_constraints::<span class="built_in">constructGoalConstraints</span>(</span><br><span class="line">    <span class="string">&quot;r_wrist_roll_link&quot;</span>, </span><br><span class="line">    quaternion</span><br><span class="line">);</span><br></pre></td></tr></table></figure>



<h2 id="moveit-msgs-OrientationConstraint"><a href="#moveit-msgs-OrientationConstraint" class="headerlink" title="moveit_msgs::OrientationConstraint"></a><strong><code>moveit_msgs::OrientationConstraint</code></strong></h2><p>方向约束</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-MoveGroup-Interface/image-20240901202439071.png" class="" title="image-20240901202439071">

<p>其中，orientation 是以四元数形式指定的机器人 link 的期望方向。<code>absolute__axis_tolerance</code> 是轴角误差公差</p>
<ul>
<li><code>moveit_msgs::JointConstraint</code>：关节约束。将关节的位置约束在一定的范围内。</li>
</ul>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-MoveGroup-Interface/image-20240901202449906.png" class="" title="image-20240901202449906">

<p>可到达的区域为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[position - tolerance_below, position + tolerance_below]</span><br></pre></td></tr></table></figure>

<ul>
<li><code>moveit_msgs::PositionConstraint</code> &#x2F;&#x2F; 位置约束</li>
</ul>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-MoveGroup-Interface/image-20240901202512856.png" class="" title="image-20240901202512856">

<p>其中，target_point_offset 为目标点偏移量；constraint_region 为 3D volume</p>
<ul>
<li><p><code>moveit_msgs::TrajectoryConstraints</code>：轨迹约束。包含每个轨迹点的约束</p>
</li>
<li><p><code>moveit_msgs::VisibilityConstraint</code>：可见性约束。该约束对于在特定坐标系中保持对圆盘(目标)的可见性很有用。该圆盘形成一个可见锥的底部，其尖端位于传感器的原点。通过确保机器人不会阻碍能见度锥来保持能见度。</p>
</li>
</ul>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Damon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daemo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Daemo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit-API/" class="post-title-link" itemprop="url">moveit-API</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-01 20:12:12" itemprop="dateCreated datePublished" datetime="2024-09-01T20:12:12+08:00">2024-09-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-22 14:42:30" itemprop="dateModified" datetime="2024-09-22T14:42:30+08:00">2024-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/" itemprop="url" rel="index"><span itemprop="name">机械臂</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/" itemprop="url" rel="index"><span itemprop="name">MoveIt</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>5 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>设置 Planner</p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">move_group_interface::MoveGroup <span class="title">group</span><span class="params">(<span class="string">&quot;manipulator&quot;</span>)</span></span>; </span><br><span class="line"><span class="comment">// See ompl_planning.yaml for a complete list</span></span><br><span class="line">group.<span class="built_in">setPlannerId</span>(<span class="string">&quot;SBLkConfigDefault&quot;</span>);   </span><br></pre></td></tr></table></figure>

<p>或在 ompl_planning.yaml 相应规划组中设置 default_planner_config 参数</p>
 <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">manipulator:</span></span><br><span class="line">  <span class="attr">planner_configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">SBLkConfigDefault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">ESTkConfigDefault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">LBKPIECEkConfigDefault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">BKPIECEkConfigDefault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">KPIECEkConfigDefault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RRTkConfigDefault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RRTConnectkConfigDefault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">RRTstarkConfigDefault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">TRRTkConfigDefault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">PRMkConfigDefault</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">PRMstarkConfigDefault</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">projection_evaluator:</span> <span class="string">joints(shoulder_pan_joint,shoulder_lift_joint)</span></span><br><span class="line">  <span class="attr">longest_valid_segment_fraction:</span> <span class="number">0.05</span></span><br><span class="line">  <span class="attr">default_planner_config:</span> <span class="string">ESTkConfigDefault</span></span><br></pre></td></tr></table></figure>





<h1 id="Python"><a href="#Python" class="headerlink" title="Python"></a>Python</h1><p>MoveIt! 接口在 move_group 中。</p>
<p>MoveGroupCommander 类常用的api列表如下：</p>
<ul>
<li>get_current_joint_values</li>
<li>set_joint_value_target</li>
<li>get_current_pose</li>
<li>set_pose_target</li>
<li><strong>plan</strong></li>
<li><strong>compute_cartesian_path</strong></li>
<li>go</li>
<li>set_max_velocity_scaling_factor</li>
<li>set_max_acceleration_scaling_factor</li>
<li>execute</li>
<li>set_path_constraints</li>
</ul>
<p>示例</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"><span class="keyword">import</span> rospy</span><br><span class="line"><span class="keyword">import</span> moveit_commander</span><br><span class="line"><span class="keyword">import</span> moveit_msgs.msg</span><br><span class="line"><span class="keyword">import</span> geometry_msgs.msg</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Starting tutorial setup&quot;</span></span><br><span class="line">moveit_commander.roscpp_initialize(sys.argv)</span><br><span class="line">rospy.init_node(<span class="string">&#x27;move_group_python_interface_tutorial&#x27;</span>, anonymous=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line">robot = moveit_commander.RobotCommander()</span><br><span class="line">group = moveit_commander.MoveGroupCommander(<span class="string">&quot;gauss_arm&quot;</span>)</span><br><span class="line"><span class="comment"># group = robot.get_group(&quot;gauss_arm&quot;) # 方法二</span></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;planning frame Reference frame: %s&quot;</span> % group.get_planning_frame()</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;end effector Reference frame: %s&quot;</span> % group.get_end_effector_link()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Printing robot state&quot;</span></span><br><span class="line"><span class="built_in">print</span> robot.get_current_state()</span><br><span class="line"></span><br><span class="line">group_variable_values = group.get_current_joint_values()</span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;Joint values: &quot;</span>, group_variable_values</span><br><span class="line"></span><br><span class="line">group_variable_values[<span class="number">0</span>] = <span class="number">1.0</span></span><br><span class="line">group.set_joint_value_target(group_variable_values)</span><br><span class="line"></span><br><span class="line">plan = group.plan()</span><br><span class="line">rospy.sleep(<span class="number">5</span>)</span><br><span class="line">group.go(wait=<span class="literal">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> <span class="string">&quot;move complete&quot;</span></span><br></pre></td></tr></table></figure>



<h2 id="computeCartesianPath"><a href="#computeCartesianPath" class="headerlink" title="computeCartesianPath"></a><strong>computeCartesianPath</strong></h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">double</span> moveit::planning_interface::MoveGroupInterface::<span class="built_in">computeCartesianPath</span>(</span><br><span class="line">    <span class="type">const</span> std::vector&lt; geometry_msgs::Pose &gt; &amp;waypoints, </span><br><span class="line">    <span class="type">double</span> eef_step, <span class="type">double</span> jump_threshold, </span><br><span class="line">    moveit_msgs::RobotTrajectory &amp;trajectory, </span><br><span class="line">    <span class="type">bool</span> avoid_collisions=<span class="literal">true</span>, </span><br><span class="line">    moveit_msgs::MoveItErrorCodes *error_code=<span class="literal">NULL</span></span><br><span class="line">)</span><br><span class="line">    </span><br><span class="line"><span class="type">double</span> moveit::planning_interface::MoveGroupInterface::<span class="built_in">computeCartesianPath</span>(</span><br><span class="line">    <span class="type">const</span> std::vector&lt; geometry_msgs::Pose &gt; &amp; 	waypoints,</span><br><span class="line">    <span class="type">double</span> 	eef_step,</span><br><span class="line">    <span class="type">double</span> 	jump_threshold,</span><br><span class="line">    moveit_msgs::RobotTrajectory &amp; 	trajectory,</span><br><span class="line">    <span class="type">const</span> moveit_msgs::Constraints &amp; 	path_constraints,</span><br><span class="line">    <span class="type">bool</span> 	avoid_collisions = <span class="literal">true</span>,</span><br><span class="line">    moveit_msgs::MoveItErrorCodes * 	error_code = <span class="literal">NULL</span> </span><br><span class="line">)	 </span><br></pre></td></tr></table></figure>

<p>参数说明：</p>
<ul>
<li><strong>waypoints</strong>：轨迹要经过的中间点，waypoints 的参考坐标系由 <a target="_blank" rel="noopener" href="https://docs.ros.org/en/kinetic/api/moveit_ros_planning_interface/html/classmoveit_1_1planning__interface_1_1MoveGroupInterface.html#aac4b6f7cb3c3257001ccbd64c6d14f46">setPoseReferenceFrame()</a> 函数指定</li>
<li><strong>eef_step</strong>：step 大小，单位 m</li>
<li><strong>jump_threshold</strong>：机器人 configuration space 中的距离变化不允许超过 jump_threshold（这是为了防止 IK solutions 中的 “jumps”）。<strong>规划的关节连续运动之间的距离 &lt;&#x3D; Jump_threshold*关节位置的平均距离&#x2F;绝对距离</strong>，其作用是在笛卡尔空间运动时，<strong>避免在经过奇异点时产生关节的抖动</strong>(经过奇异点时，某个轴会短时间内高速运动从而产生抖动)</li>
<li><strong>trajectory</strong>：</li>
<li><strong>avoid_collisions</strong>：默认为 true，开启碰撞检测，若规划的轨迹无法避免碰撞，则执行失败</li>
<li><strong>error_code</strong>：</li>
</ul>
<p>返回值 fraction：返回一个介于 0.0 和 1.0 之间的值，表示规划出的路径的分数。出错时返回 -1.0。该返回值描述规划后的运动轨迹在路点列表中的覆盖率。如果 fraction 小于 1 则有路点没有进入规划；等于1的话就可以用execute()执行了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit%E6%B6%88%E6%81%AF%E4%BD%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Damon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daemo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Daemo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit%E6%B6%88%E6%81%AF%E4%BD%93/" class="post-title-link" itemprop="url">moveit消息体</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-01 18:45:23" itemprop="dateCreated datePublished" datetime="2024-09-01T18:45:23+08:00">2024-09-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-22 14:42:30" itemprop="dateModified" datetime="2024-09-22T14:42:30+08:00">2024-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/" itemprop="url" rel="index"><span itemprop="name">机械臂</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/" itemprop="url" rel="index"><span itemprop="name">MoveIt</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>3.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="moveit-msgs-Grasp"><a href="#moveit-msgs-Grasp" class="headerlink" title="moveit_msgs::Grasp"></a><strong>moveit_msgs::Grasp</strong></h1><p>此消息包含对 grasp 的描述，该 grasp 将与特定的末端执行器(end-effector)一起使用，以抓取对象，包括如何接近、抓取对象等。此消息不包含有关 “抓点(grasp point - 即:目标物体上的点)” 的任何信息。无论生成此消息的是什么，都应该已经将有关抓取点的信息与有关末端执行器的几何形状的信息进行组合，以计算此消息中的 grasp_pose。</p>
<p>moveit grasp 消息格式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"># A name for this grasp</span><br><span class="line">string id</span><br><span class="line"></span><br><span class="line"># 抓取前<span class="punctuation">,</span> end effector group 中关节的轨迹位置<span class="punctuation">,</span>即<span class="punctuation">:</span>抓取前位姿</span><br><span class="line">trajectory_msgs/JointTrajectory pre_grasp_posture</span><br><span class="line"></span><br><span class="line"># 抓取时的姿态<span class="punctuation">,</span>包括位置和力度  </span><br><span class="line">trajectory_msgs/JointTrajectory grasp_posture</span><br><span class="line"></span><br><span class="line"># grasp 的 end-effector 的位置. 是 end-effector 的 <span class="string">&quot;parent_link&quot;</span> 的位置.</span><br><span class="line">geometry_msgs/PoseStamped grasp_pose</span><br><span class="line"></span><br><span class="line"># 此次抓取的预估成功率<span class="punctuation">,</span> 或其他衡量它有多“好”的方法。</span><br><span class="line">float64 grasp_quality</span><br><span class="line"></span><br><span class="line"># 在进行抓取之前，机器人末端的前进方向，以及前进距离</span><br><span class="line">GripperTranslation pre_grasp_approach</span><br><span class="line"></span><br><span class="line"># 抓握完成后的撤退方向</span><br><span class="line">GripperTranslation post_grasp_retreat</span><br><span class="line"></span><br><span class="line"># 释放物体时的后退动作;这个信息对grasp本身来说不是必要的，</span><br><span class="line"># 但是当释放物体时，这个信息是必要的。 </span><br><span class="line"># 用于执行 pickup 的抓取将作为结果的一部分返回，因此该信息可用于以后使用。 </span><br><span class="line">GripperTranslation post_place_retreat</span><br><span class="line"></span><br><span class="line"># 抓握时使用的最大接触力(&lt;=<span class="number">0</span> 时禁用)  </span><br><span class="line">float32 max_contact_force</span><br><span class="line"></span><br><span class="line"># 可选的障碍列表，我们有语义信息，可以在抓取过程中触摸/推/移动  </span><br><span class="line">string<span class="punctuation">[</span><span class="punctuation">]</span> allowed_touch_objects</span><br></pre></td></tr></table></figure>

<p>示例：<code>moveit_tutorials/doc/pick_place/src/pick_place_tutorial.cpp</code></p>
<figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">double</span> tau = <span class="number">2</span> * M_PI;</span><br><span class="line">...</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">openGripper</span><span class="params">(trajectory_msgs::JointTrajectory&amp; posture)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// BEGIN_SUB_TUTORIAL open_gripper</span></span><br><span class="line">  <span class="comment">/* Add both finger joints of panda robot. */</span></span><br><span class="line">  posture.joint_names.<span class="built_in">resize</span>(<span class="number">2</span>);</span><br><span class="line">  posture.joint_names[<span class="number">0</span>] = <span class="string">&quot;panda_finger_joint1&quot;</span>;</span><br><span class="line">  posture.joint_names[<span class="number">1</span>] = <span class="string">&quot;panda_finger_joint2&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Set them as open, wide enough for the object to fit. */</span></span><br><span class="line">  posture.points.<span class="built_in">resize</span>(<span class="number">1</span>);</span><br><span class="line">  posture.points[<span class="number">0</span>].positions.<span class="built_in">resize</span>(<span class="number">2</span>);</span><br><span class="line">  posture.points[<span class="number">0</span>].positions[<span class="number">0</span>] = <span class="number">0.04</span>;</span><br><span class="line">  posture.points[<span class="number">0</span>].positions[<span class="number">1</span>] = <span class="number">0.04</span>;</span><br><span class="line">  posture.points[<span class="number">0</span>].time_from_start = ros::<span class="built_in">Duration</span>(<span class="number">0.5</span>);</span><br><span class="line">  <span class="comment">// END_SUB_TUTORIAL</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">closedGripper</span><span class="params">(trajectory_msgs::JointTrajectory&amp; posture)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">/* Add both finger joints of panda robot. */</span></span><br><span class="line">  posture.joint_names.<span class="built_in">resize</span>(<span class="number">2</span>);</span><br><span class="line">  posture.joint_names[<span class="number">0</span>] = <span class="string">&quot;panda_finger_joint1&quot;</span>;</span><br><span class="line">  posture.joint_names[<span class="number">1</span>] = <span class="string">&quot;panda_finger_joint2&quot;</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* Set them as closed. */</span></span><br><span class="line">  posture.points.<span class="built_in">resize</span>(<span class="number">1</span>);</span><br><span class="line">  posture.points[<span class="number">0</span>].positions.<span class="built_in">resize</span>(<span class="number">2</span>);</span><br><span class="line">  posture.points[<span class="number">0</span>].positions[<span class="number">0</span>] = <span class="number">0.00</span>;</span><br><span class="line">  posture.points[<span class="number">0</span>].positions[<span class="number">1</span>] = <span class="number">0.00</span>;</span><br><span class="line">  posture.points[<span class="number">0</span>].time_from_start = ros::<span class="built_in">Duration</span>(<span class="number">0.5</span>);</span><br><span class="line">  <span class="comment">// END_SUB_TUTORIAL</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">pick</span><span class="params">(moveit::planning_interface::MoveGroupInterface&amp; move_group)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="comment">// 创建一个要尝试的抓取向量，目前只创建单个抓取。在使用 grasp generator 生成和测试多个grasp时非常有用</span></span><br><span class="line">  std::vector&lt;moveit_msgs::Grasp&gt; grasps;</span><br><span class="line">  grasps.<span class="built_in">resize</span>(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置抓取位姿.此例中，为 panda_link8 的位姿</span></span><br><span class="line">  grasps[<span class="number">0</span>].grasp_pose.header.frame_id = <span class="string">&quot;panda_link0&quot;</span>;</span><br><span class="line">  tf2::Quaternion orientation;</span><br><span class="line">  orientation.<span class="built_in">setRPY</span>(-tau / <span class="number">4</span>, -tau / <span class="number">8</span>, -tau / <span class="number">4</span>);</span><br><span class="line">  grasps[<span class="number">0</span>].grasp_pose.pose.orientation = tf2::<span class="built_in">toMsg</span>(orientation);</span><br><span class="line">  grasps[<span class="number">0</span>].grasp_pose.pose.position.x = <span class="number">0.415</span>;</span><br><span class="line">  grasps[<span class="number">0</span>].grasp_pose.pose.position.y = <span class="number">0</span>;</span><br><span class="line">  grasps[<span class="number">0</span>].grasp_pose.pose.position.z = <span class="number">0.5</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Setting pre-grasp approach.抓取之前，机器人末端的前进方向，以及前进距离</span></span><br><span class="line">  grasps[<span class="number">0</span>].pre_grasp_approach.direction.header.frame_id = <span class="string">&quot;panda_link0&quot;</span>;</span><br><span class="line">  <span class="comment">/* 方向为 x 轴正轴方向 */</span></span><br><span class="line">  grasps[<span class="number">0</span>].pre_grasp_approach.direction.vector.x = <span class="number">1.0</span>;</span><br><span class="line">  grasps[<span class="number">0</span>].pre_grasp_approach.min_distance = <span class="number">0.095</span>;</span><br><span class="line">  grasps[<span class="number">0</span>].pre_grasp_approach.desired_distance = <span class="number">0.115</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// Setting post-grasp retreat. 抓握完成后的撤退方向</span></span><br><span class="line">  grasps[<span class="number">0</span>].post_grasp_retreat.direction.header.frame_id = <span class="string">&quot;panda_link0&quot;</span>;</span><br><span class="line">  <span class="comment">/* 方向为 Z 轴正向 */</span></span><br><span class="line">  grasps[<span class="number">0</span>].post_grasp_retreat.direction.vector.z = <span class="number">1.0</span>;</span><br><span class="line">  grasps[<span class="number">0</span>].post_grasp_retreat.min_distance = <span class="number">0.1</span>;</span><br><span class="line">  grasps[<span class="number">0</span>].post_grasp_retreat.desired_distance = <span class="number">0.25</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// pre_grasp_posture:抓取前,eef group 中关节的轨迹位置,即:抓取前位姿</span></span><br><span class="line">  <span class="built_in">openGripper</span>(grasps[<span class="number">0</span>].pre_grasp_posture);</span><br><span class="line">  <span class="comment">// grasp_posture:抓取时的姿态,包括位置和力度  </span></span><br><span class="line">  <span class="built_in">closedGripper</span>(grasps[<span class="number">0</span>].grasp_posture);</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 设置支撑面</span></span><br><span class="line">  move_group.<span class="built_in">setSupportSurfaceName</span>(<span class="string">&quot;table1&quot;</span>);</span><br><span class="line">  <span class="comment">// Call pick to pick up the object using the grasps given</span></span><br><span class="line">  move_group.<span class="built_in">pick</span>(<span class="string">&quot;object&quot;</span>, grasps);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Damon">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Daemo">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | Daemo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/" class="post-title-link" itemprop="url">moveit</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-09-01 17:33:13" itemprop="dateCreated datePublished" datetime="2024-09-01T17:33:13+08:00">2024-09-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2024-09-22 14:42:30" itemprop="dateModified" datetime="2024-09-22T14:42:30+08:00">2024-09-22</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/" itemprop="url" rel="index"><span itemprop="name">机械臂</span></a>
        </span>
          ，
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/" itemprop="url" rel="index"><span itemprop="name">MoveIt</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>7.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>13 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="MoveIt-系统结构"><a href="#MoveIt-系统结构" class="headerlink" title="MoveIt! 系统结构"></a>MoveIt! 系统结构</h1><h2 id="概览"><a href="#概览" class="headerlink" title="概览"></a>概览</h2><img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901173810700.png" class="" title="image-20240901173810700">



<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901173833469.png" class="" title="image-20240901173833469">

<h2 id="move-group-节点"><a href="#move-group-节点" class="headerlink" title="move_group 节点"></a>move_group 节点</h2><img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901173731744-1725183457499-1-1725183460949-3.png" class="" title="image-20240901173731744">

<p>JointTrajectoryAction 通过 Robot Controllers 进行翻译。</p>
<h2 id="组件"><a href="#组件" class="headerlink" title="组件"></a><strong>组件</strong></h2><ul>
<li><p><strong>move_group</strong>：该节点充当整合器。整合多个独立的组件</p>
</li>
<li><p><strong>User Interface</strong>：用户接口。包括：</p>
</li>
<li><ul>
<li>C++，利用 <a href="https://link.zhihu.com/?target=http://docs.ros.org/melodic/api/moveit_ros_planning_interface/html/classmoveit_1_1planning__interface_1_1MoveGroupInterface.html"><strong>move_group_interface</strong></a> 包提供的接口 </li>
<li>Python，利用 <a href="https://link.zhihu.com/?target=http://docs.ros.org/melodic/api/moveit_commander/html/classmoveit__commander_1_1move__group_1_1MoveGroupCommander.html"><strong>moveit_commander</strong></a> 包提供的接口</li>
<li>GUI，<a href="https://link.zhihu.com/?target=https://ros-planning.github.io/moveit_tutorials/doc/quickstart_in_rviz/quickstart_in_rviz_tutorial.html">rviz Motion Planning</a> 插件</li>
</ul>
</li>
<li><p><strong>配置</strong>：move_group 节点从 ROS param server 获取三种信息</p>
<ul>
<li><strong>URDF</strong>：查找 <strong>robot_description</strong> 参数，获取 URDF</li>
<li><strong>SRDF</strong>：查找 <strong>robot_description_semantic</strong> 参数，获取 SRDF，其一般由 MoveIt! Setup Assistant 生成</li>
<li><strong>MoveIt! configuration</strong>：获取其它信息，如 joint limits、kinematics、motion planning、perception 等</li>
</ul>
</li>
<li><p><strong>Robot Interface</strong></p>
<ul>
<li><strong>move_group 节点通过 ROS topics 和 actions 与机器人通信</strong>，获取机器人状态、传感器数据等</li>
</ul>
</li>
<li><p><strong>Joint State Information</strong>：</p>
<ul>
<li>move_group 监听 <code>/joint_states</code> 主题获取状态信息</li>
</ul>
</li>
<li><p><strong>Transform Information</strong>：变换信息</p>
<ul>
<li>move_group 通过 tf 来监听变换信息</li>
</ul>
</li>
<li><p><strong>Controller Interface</strong>：控制接口</p>
<ul>
<li>通过 ROS 的 action 接口，<strong>FollowJointTrajectoryAction</strong> 来使用控制器</li>
</ul>
</li>
<li><p><strong>Planning Scene</strong>：规划场景</p>
<ul>
<li>move_group 使用规划场景监视器来维护规划场景</li>
<li>Scene 是 world 和 机器人的状态的表现</li>
</ul>
</li>
<li><p><strong>Extensible Capabilities</strong>：</p>
<ul>
<li>move_group 的结构易于扩展 - 拾取和放置、运动学、运动规划等单个功能实际上是作为具有公共基类的单独插件实现的。这些插件可以通过一组 ROS yaml 参数和使用 ROS 插件库来使用 ROS 进行配置。大多数用户不必配置 move_group 插件，因为它们是在 MoveIt 设置助手生成的启动文件中自动配置的</li>
</ul>
</li>
</ul>
<h2 id="三大核心功能"><a href="#三大核心功能" class="headerlink" title="三大核心功能"></a><strong>三大核心功能</strong></h2><ul>
<li><p>运动学</p>
<ul>
<li>KDL</li>
<li>Trac-IK</li>
<li>IKFast</li>
</ul>
</li>
<li><p>路径规划</p>
<ul>
<li>OMPL</li>
<li>CHOMP</li>
<li>SBPL</li>
</ul>
</li>
<li><p>碰撞检测</p>
<ul>
<li>FCL</li>
<li>PCD</li>
</ul>
</li>
</ul>
<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a><strong>工作流程</strong></h2><p>MoveIt! 输入用户指令，比如起始位置，输出轨迹数据，每个点由位置、速度加速度描述，为了通过话题发出来，还需要一个 Follow Joint Trajectory 功能，通过通信接口发给机器人，机器人还需要对轨迹进行<strong>精插补</strong>，再驱动电机同步运动。机器人控制器还需要将每个电机的状态数据反馈给 MoveIt! 来确定机器人是否到达指定位置，这样完成一个闭环。</p>
<p>即：接收到指令后，MoveIt! 进行规划，得到轨迹数据(trajectory data)，通过 <strong>Follow Joint Trajectory</strong> 接口，将轨迹信息封装成 Action，发送给 Trajectory Controller，然后进行<strong>插补运算</strong>(轨迹中是一些中间间隔一定时间长度的轨迹点，这个时间不可以直接用做控制，控制器要求这个时间必须细微，所以就涉及到了插补算法)，插补算法完成各个轴的插补运算，然后将数据发送给 Position Servo，驱动器接收数据后，驱动电机发生运动。同时机器人端通过 Joint State Controller 将状态信息反馈给 MoveIt!。</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901174108187.png" class="" title="image-20240901174108187">

<p>主要包含三个模块：</p>
<ul>
<li><strong>Follow Joint Trajectory</strong>：将规划的轨迹封装为 Action，然后发送给 Trajectory Controller</li>
<li><strong>Joint Trajectory Controller</strong>：轨迹插补(Trajectory Interpolation)</li>
<li><strong>Joint State Controller</strong>：反馈机器人关节状态</li>
</ul>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901174131395.png" class="" title="image-20240901174131395">

<p>ROS 提供的关节轨迹控制器插补运算：</p>
<ul>
<li><strong>线性样条</strong>：位置连续，速度、加速度不连续</li>
<li><strong>三次样条</strong>：位置和速度连续，加速度不连续</li>
<li><strong>五次样条</strong>：位置、速度、加速度都连续（ROS 默认使用的）</li>
</ul>
<h1 id="Motion-Planning"><a href="#Motion-Planning" class="headerlink" title="Motion Planning"></a>Motion Planning</h1><h2 id="Motion-Planning-Plugin"><a href="#Motion-Planning-Plugin" class="headerlink" title="Motion Planning Plugin"></a>Motion Planning Plugin</h2><p>MoveIt 通过插件接口与运动规划器合作。这允许 MoveIt 与来自多个库的不同运动规划器进行通信和使用，从而使 MoveIt 易于扩展。运动规划器的接口是通过 ROS action 或 service。move_group 的默认运动规划器是使用 OMPL。默认情况下可用的其他规划器包括 <strong>Pilz 工业运动规划器</strong>和 CHOMP 规划器。</p>
<h2 id="Motion-Plan-Request"><a href="#Motion-Plan-Request" class="headerlink" title="Motion Plan Request"></a>Motion Plan Request</h2><p>运动计划请求指定希望运动规划器执行的操作。通常，将要求运动规划器将手臂移动到不同的位置（在关节空间中）或将末端执行器移动到新的姿态。默认情况下会检查碰撞（包括自碰撞和附着对象）。还可以通过 <code>planning_pipeline</code> 和 <code>planner_id</code> 参数指定规划器，以及运动规划器要检查的约束 - MoveIt 提供的内置约束是运动学约束：</p>
<ul>
<li><strong>Position constraints</strong>：将 link 的位置限制在某个区域内</li>
<li><strong>Orientation constraints</strong>：限定 link 的姿态在指定的 roll、pitch、yaw 限制范围内</li>
<li><strong>Visiblity constraints</strong>：限制 link 上的一个点位于特定传感器的可见性锥(cone)内</li>
<li><strong>Joint constraints</strong>：限制关节范围</li>
<li><strong>用户自定义约束</strong>：</li>
</ul>
<p>MotionPlanRequest：</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901190156730.png" class="" title="image-20240901190156730">




<h2 id="Motion-Plan-Result"><a href="#Motion-Plan-Result" class="headerlink" title="Motion Plan Result"></a>Motion Plan Result</h2><p>move_group 节点接收到 motion plan request 后将生成一条轨迹。这一轨迹将移动手臂(或任何一组关节)到所需的位置。请注意，move_group 的结果是一条轨迹，而不仅仅是一个路径 ——_move_group*将使用所需的最大速度和加速度(如果指定)来生成一个遵守关节限制的速度和加速度约束的轨迹。</p>
<h2 id="Motion-Planning-Pipeline"><a href="#Motion-Planning-Pipeline" class="headerlink" title="Motion Planning Pipeline"></a>Motion Planning Pipeline</h2><p>Motion planners and Plan Request adapters</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901190057195.png" class="" title="image-20240901190057195">

<p>完整的 motion planning pipeline 将 motion planner 与其他称为 planning request adapters 的组件连接在一起。<strong>规划请求适配器允许对运动规划请求进行预处理，并对运动规划响应进行后处理</strong>。预处理在几种情况下是有用的，例如，当机器人的启动状态略微超出机器人指定的关节限制时。后处理还需要进行其他一些操作，例如将机器人生成的路径转换为时间参数化的轨迹。MoveIt 提供了一组默认的运动规划适配器，每个适配器执行一个非常特定的功能。</p>
<h2 id="FixStartStateBounds"><a href="#FixStartStateBounds" class="headerlink" title="FixStartStateBounds"></a>FixStartStateBounds</h2><p>该 adapter 将开始状态修复为满足 URDF 中指定的关节限制。在物理机器人的关节限制没有正确配置的情况下，就需要这种适配器。然后，机器人可能最终处于一个或多个关节略微超出其关节极限的配置中。在这种情况下，运动规划器无法进行规划，因为它会认为起始状态在关节限制之外。“FixStartStateBounds”规划请求适配器将通过将其移动到关节限制来“修复”开始状态。然而，这显然不是每次都是正确的解决方案——例如，当关节确实超出了关节极限很大程度时。适配器的一个参数指定了关节可以超出其“可修复”的限制的程度。</p>
<h2 id="FixWorkspaceBounds"><a href="#FixWorkspaceBounds" class="headerlink" title="FixWorkspaceBounds"></a>FixWorkspaceBounds</h2><p>该适配器将<strong>指定用于规划的默认工作空间</strong>：大小为 10 m x 10 m x 10 m 的立方体。仅当对 planner 的规划请求未填写这些字段时，才会指定此工作区。</p>
<h2 id="FixStartStateCollision"><a href="#FixStartStateCollision" class="headerlink" title="FixStartStateCollision"></a>FixStartStateCollision</h2><p>该适配器将尝试通过少量扰动关节值来对指定配置（冲突中）附近的新无碰撞配置进行采样。扰动值的量由“jiggle_fraction”参数指定，该参数将扰动控制为关节总运动范围的百分比。此适配器的另一个参数指定适配器在放弃之前将采样的随机扰动数。</p>
<h2 id="FixStartStatePathCostraints"><a href="#FixStartStatePathCostraints" class="headerlink" title="FixStartStatePathCostraints"></a><strong>FixStartStatePathCostraints</strong></h2><p>当运动规划的开始状态不遵守指定的路径约束时，将应用此适配器。它将尝试规划机器人当前配置与遵守路径约束的新位置之间的路径。新位置将用作规划的开始状态。</p>
<h2 id="AddTimeParameterization"><a href="#AddTimeParameterization" class="headerlink" title="AddTimeParameterization"></a><strong>AddTimeParameterization</strong></h2><p>运动规划器通常会生成“运动学路径”，即无速度或加速度信息的路径。该适配器将通过应用速度和加速度约束来“时间参数化”运动计划。</p>
<h2 id="ResolveConstraintFrame"><a href="#ResolveConstraintFrame" class="headerlink" title="ResolveConstraintFrame"></a><strong>ResolveConstraintFrame</strong></h2><p>可以使用 subframes 设置目标约束（例如，杯子&#x2F;手柄坐标系中的姿势目标，其中手柄是杯子上的 subframe）。该适配器将约束坐标系更改为对象或机器人坐标系（例如杯子）。</p>
<h1 id="OMPL"><a href="#OMPL" class="headerlink" title="OMPL"></a><strong>OMPL</strong></h1><p>OMPL（开放式运动规划库）是一个开源运动规划库，主要实现随机运动规划器。MoveIt 直接集成 OMPL，并使用该库中的运动规划器作为其主要&#x2F;默认规划器集。OMPL 中的规划器是抽象的；即 OMPL 没有机器人的概念。相反，MoveIt 配置 OMPL 并为 OMPL 提供后端来处理机器人技术中的问题。</p>
<h2 id="Planning-Scene"><a href="#Planning-Scene" class="headerlink" title="Planning Scene"></a><strong>Planning Scene</strong></h2>  <img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901190559440.png" class="" title="image-20240901190559440">

<p>规划场景用于表示机器人周围的世界，并存储机器人本身的状态。它由 move group 节点内的 planning scene monitor 维护。Planning scene monitor 监听：</p>
<ul>
<li>状态信息：joint_states 主题</li>
<li>传感器信息：使用 world geometry monitor</li>
<li>World geometry 信息：来自用户对 planning_scene 主题的输入（作为规划场景差异）</li>
</ul>
<h2 id="World-Geometry-Monitor"><a href="#World-Geometry-Monitor" class="headerlink" title="World Geometry Monitor"></a><strong>World Geometry Monitor</strong></h2><p>使用机器人传感器数据或用户输入数据来构建 world geometry。</p>
<p>使用 occupancy map monitor 来构建机器人周围环境的 3D 表示，并使用 planning_scene 主题的信息来增强该表示，以添加对象信息。</p>
<h2 id="3D-Perception"><a href="#3D-Perception" class="headerlink" title="3D Perception"></a><strong>3D Perception</strong></h2><p>MoveIt 中 3D perception 由 occupancy map monitor，使用插件架构来处理不同类型的传感器输入。特别是，MoveIt 内置了对处理两种输入的支持：</p>
<ul>
<li>Point clouds：由 <strong>point cloud occupancy map updater</strong> 插件处理</li>
<li>Depth images：由 <strong>depth image occupancy map updater</strong> 插件处理</li>
</ul>
<h3 id="Octomap"><a href="#Octomap" class="headerlink" title="Octomap"></a><strong>Octomap</strong></h3><p>Occupancy map monitor 使用 octomap 来维护环境的占用地图。Octomap 实际上可以编码有关单个 cell 的概率信息，尽管此信息目前未在 MoveIt 中使用。Octomap 可以直接传递到 FCL，FCL 是 MoveIt 使用的碰撞检查库。</p>
<h3 id="Depth-Image-Occupancy-map-updater"><a href="#Depth-Image-Occupancy-map-updater" class="headerlink" title="Depth Image Occupancy map updater"></a><strong>Depth Image Occupancy map updater</strong></h3><p>该 updater 包括其自己的自我过滤器，即它将从深度图中删除机器人的可见部分。它使用有关机器人的当前信息（机器人状态）来执行此操作。</p>
<h1 id="Kinematics"><a href="#Kinematics" class="headerlink" title="Kinematics"></a><strong>Kinematics</strong></h1><h2 id="Kinematics-插件"><a href="#Kinematics-插件" class="headerlink" title="Kinematics 插件"></a><strong>Kinematics 插件</strong></h2><p>MoveIt 使用插件方式，允许用户编写自己的反向运动学算法。正向运动学和查找雅可比矩阵集成在 RobotState 类中。MoveIt 的默认逆运动学插件是使用 KDL 基于雅可比数值的求解器配置的。</p>
<h2 id="IKFast-插件"><a href="#IKFast-插件" class="headerlink" title="IKFast 插件"></a><strong>IKFast 插件</strong></h2><p>通常，用户会选择实现自定义的逆运动学求解器。实现此类求解器的一种流行方法是使用 IKFast 包生成使用特定机器人所需的 C++ 代码。</p>
<h1 id="Collision-Checking"><a href="#Collision-Checking" class="headerlink" title="Collision Checking"></a><strong>Collision Checking</strong></h1><p>MoveIt 中的碰撞检查是使用 CollisionWorld 对象在 planning scene 中配置的。幸运的是，MoveIt 的设置使用户永远不必担心冲突检查是如何发生的。MoveIt 中的碰撞检查主要使用 FCL 包。</p>
<h2 id="Collision-Objects"><a href="#Collision-Objects" class="headerlink" title="Collision Objects"></a><strong>Collision Objects</strong></h2><p>MoveIt 碰撞检测支持多种类型的物体：</p>
<ul>
<li>Meshes</li>
<li>Primitive Shapes：如 boxes、cylinders、cones、spheres及平面</li>
<li>Octomap：Octomap 物体可直接用于碰撞检测</li>
</ul>
<h2 id="Allowed-Collision-Matrix-ACM"><a href="#Allowed-Collision-Matrix-ACM" class="headerlink" title="Allowed Collision Matrix(ACM)"></a><strong>Allowed Collision Matrix(ACM)</strong></h2><p>碰撞检查非常耗时，通常占运动规划期间计算耗时的近 90%。允许的碰撞矩阵或 ACM 编码一个二进制值，对应于需要检查成对的物体之间的碰撞。如果在 ACM 中将对应于两个主体的值设置为 1，则指定不需要在两个主体之间进行碰撞检查。例如，如果两个物体总是相距很远，以至于它们永远不会相互碰撞，就会发生这种情况。</p>
<h1 id="Traojectory-Processing"><a href="#Traojectory-Processing" class="headerlink" title="Traojectory Processing"></a><strong>Traojectory Processing</strong></h1><h2 id="Time-parameterization"><a href="#Time-parameterization" class="headerlink" title="Time parameterization"></a><strong>Time parameterization</strong></h2><p>Motion planner 通常只会生成“路径”，即没有与路径相关的时序信息。MoveIt 包含一个轨迹处理例程，可以在这些路径上工作并生成经过适当时间参数化的轨迹，考虑到对单个关节施加的最大速度和加速度限制。这些限制从 joint_limits.yaml 文件中读取的。</p>
<h1 id="Developer’s-Concept"><a href="#Developer’s-Concept" class="headerlink" title="Developer’s Concept"></a><strong>Developer’s Concept</strong></h1><h2 id="Collision-Detection"><a href="#Collision-Detection" class="headerlink" title="Collision Detection"></a><strong>Collision Detection</strong></h2><p>规划场景可以访问多个不同的碰撞检测器。每个检测器都从抽象父类  CollisionEnv 派生出自己的碰撞环境。请注意，在 2019 年 8 月之前，MoveIt 没有单一的碰撞环境，而是两个：CollisionWorld 和 CollisionRobot。CollisionRobot 负责自碰撞检查，而 CollisionWorld 则对机器人与环境进行碰撞检查。</p>
<p>有关碰撞检测背后的理论的一般介绍，<a target="_blank" rel="noopener" href="https://www.toptal.com/game/video-game-physics-part-ii-collision-detection-for-solid-objects">Video Game Physics Tutorial - Part II: Collision Detection for Solid Objects</a>很有帮助。此外，Christer Ericson的《Realtime Collision Detection》一书是一个很好的资源。</p>
<h2 id="Flexible-Collision-Library-FCL"><a href="#Flexible-Collision-Library-FCL" class="headerlink" title="Flexible Collision Library(FCL)"></a><strong>Flexible Collision Library(FCL)</strong></h2><p>FCL 是一种可用的碰撞检测器。它衍生了自己的碰撞环境，主要结合了以前的 CollisionRobotFCL 和 CollisionWorldFCL。</p>
<p>CollisionRobotFCL：机器人 link 几何图形保存为成员变量。当执行自碰撞检查时，将创建一个新的 FCL manager，并将所有 links 添加到其中。由于 link 几何图形只计算一次并持久存储(包括它们的本地AABB)，因此将它们添加到新的碰撞管理器的成本很低。然后，在对 overlapping pairs 进行 narrowphase 计算之前，使用更新的全局 AABB 进行 broadphase 碰撞检验。</p>
<p>CollisionWorldFCL：包含一个成员碰撞管理器，所有的 world 对象都被添加或删除。该管理器具有用于快速 overlap 计算的持久树结构。当执行机器人与 world 的碰撞检查时，所有的机器人 links 都是针对世界 world 测试的，因为不需要在这里进行自我碰撞检查。为此，将使用 CollisionRobot 中包含的预先计算的碰撞几何图形，并根据当前机器人状态更新它们的全局姿态。</p>
<p>碰撞检查流程如下图所示</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901190658163.png" class="" title="image-20240901190658163">



<h2 id="Bullet-Collision-Detection"><a href="#Bullet-Collision-Detection" class="headerlink" title="Bullet Collision Detection"></a><strong>Bullet Collision Detection</strong></h2><p>Bullet 是第二个可用的碰撞检测器。碰撞环境包含一个用于离散和连续检查的管理器。碰撞检查流程如下图所示。</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901190717401.png" class="" title="image-20240901190717401">

<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901190723439.png" class="" title="image-20240901190723439">

<h2 id="TrajOpt-Planner"><a href="#TrajOpt-Planner" class="headerlink" title="TrajOpt Planner"></a><strong>TrajOpt Planner</strong></h2><p>TrajOpt 是一种基于优化的 motion planner：</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901190739645.png" class="" title="image-20240901190739645">



<h1 id="使用方法"><a href="#使用方法" class="headerlink" title="使用方法"></a>使用方法</h1><p>MoveIt! 使用流程：</p>
<ul>
<li>创建 URDF 模型</li>
<li>配置：使用 MoveIt! Setup Assistant 生成配置文件</li>
<li>添加机器人控制器插件 controller</li>
<li>MoveIt! 控制机器人运动</li>
</ul>
<h1 id="MoveIt-Commander-Scripting"><a href="#MoveIt-Commander-Scripting" class="headerlink" title="MoveIt Commander Scripting"></a>MoveIt Commander Scripting</h1><p>moveit_commander Python 包为 MoveIt 中的功能提供了包装器。简单的可用于运动规划、笛卡尔路径计算和拾取和放置的界面。moveit_commander 包还包括一个命令行接口 <code>moveit_commander_cmdline.py</code>。</p>
<p>运行：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">roslaunch panda_moveit_config demo.launch</span></span><br><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">rosrun moveit_commander moveit_commander_cmdline.py</span></span><br></pre></td></tr></table></figure>

<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901174252440.png" class="" title="image-20240901174252440">

<p>连接 move_group 节点</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt; use &lt;group name&gt; # 首先，使用该指令根据指定的 group 名连接到 move_group 节点</span><br></pre></td></tr></table></figure>

<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901174320164.png" class="" title="image-20240901174320164">

<p>查询当前状态</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901174336930.png" class="" title="image-20240901174336930">

<p>保存当前状态</p>
<img src="/2024/09/01/%E6%9C%BA%E6%A2%B0%E8%87%82/MoveIt/moveit/image-20240901174348487.png" class="" title="image-20240901174348487">

<p>移动机器人</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">goal = c </span><br><span class="line">goal[0] = 0.2 </span><br><span class="line">go goal</span><br></pre></td></tr></table></figure>

<p>也可使用以下语句，该方式稍微繁杂，但 plan 命令允许在实际发出执行命令之前在 RViz 中可视化计算的运动计划</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">goal[0] = 0.2 </span><br><span class="line">goal[1] = 0.2 </span><br><span class="line">plan goal </span><br><span class="line">execute </span><br></pre></td></tr></table></figure>



<h1 id="Fake-Controller-Manager"><a href="#Fake-Controller-Manager" class="headerlink" title="Fake Controller Manager"></a>Fake Controller Manager</h1><p>MoveIt 提供了一系列用于模拟的 fake 轨迹控制器。例如：由 MoveIt setup assistant 生成的 demo.launch，使用 fake 控制器在 RViz 中很好的可视化。</p>
<p>通过 config&#x2F;fake_controllers.yaml 文件进行配置，并调整所需的控制器类型。已安装的控制器包括:<br>interpolate：在 via points 之间执行平滑插值；默认选项，用于可视化<br>via points：遍历 via points，在中间 w&#x2F;o 插值；对可视化调试很有用<br>last points：直接 wrap 到轨迹的最后一点；离线基准测试的最快方法</p>
<p>yaml 文件示例</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">rate:</span> <span class="number">10</span> <span class="string">(Hz,</span> <span class="string">used</span> <span class="string">for</span> <span class="string">interpolation</span> <span class="string">controller)</span></span><br><span class="line"><span class="attr">controller_list:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fake_arm_controller</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">interpolate</span> <span class="string">|</span> <span class="string">via</span> <span class="string">points</span> <span class="string">|</span> <span class="string">last</span> <span class="string">point</span></span><br><span class="line">    <span class="attr">joints:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_1</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_2</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_3</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_4</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_5</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">joint_6</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">fake_gripper_controller</span></span><br><span class="line">    <span class="attr">joints:</span></span><br><span class="line">      []</span><br></pre></td></tr></table></figure>

<p>为了加载一个初始的姿势，可以有一个(group, pose)对列表，如下所示:</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">initial:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="attr">group:</span> <span class="string">arm</span></span><br><span class="line">    <span class="attr">pose:</span>  <span class="string">ready</span></span><br></pre></td></tr></table></figure>



<h1 id="压力测试-Benchmarking"><a href="#压力测试-Benchmarking" class="headerlink" title="压力测试 Benchmarking"></a>压力测试 Benchmarking</h1><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">$ </span><span class="language-bash">roslaunch panda_moveit_config demo.launch db:=<span class="literal">true</span></span></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <a class="extend prev" rel="prev" title="上一页" aria-label="上一页" href="/page/12/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><span class="page-number current">13</span>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Damon</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
      <span>站点总字数：</span>
    <span title="站点总字数">507k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
      <span>站点阅读时长 &asymp;</span>
    <span title="站点阅读时长">15:21</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/pisces/" rel="noopener" target="_blank">NexT.Pisces</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>





</body>
</html>
